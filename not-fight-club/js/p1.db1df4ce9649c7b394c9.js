(()=>{"use strict";var e={350:(e,t,r)=>{r.d(t,{CT:()=>s,J_:()=>o,Qx:()=>a,mF:()=>c,mV:()=>i,vK:()=>n});const n=150,o=10,i=1,s=2,a={HEAD:{id:1,name:"Head"},NECK:{id:2,name:"Neck"},BODY:{id:3,name:"Body"},BELLY:{id:4,name:"Belly"},LEGS:{id:5,name:"Legs"}},c=e=>new Promise((t,r)=>{const n=new Image;n.onload=()=>t(n),n.onerror=r,n.src=e,n.alt="avatar"})},711:(e,t,r)=>{r.r(t),r.d(t,{Hero:()=>o});var n=r(350);class o{constructor(e="",t=0,r=0,o="",i=!1,s=n.vK,a=0,c=0){this.name=e,this.avatar=o,this.wins=t,this.loses=r,this.player=i,this.health=s,this.attCount=a,this.defCount=c}}},969:(e,t,r)=>{r.r(t),r.d(t,{Player:()=>i});var n=r(711),o=r(350);class i extends n.Hero{constructor(e,t,r,n,i,s,a,c){super(e,t,r,n,i,s,a,c),this.avatar="./assets/images/lazy.png",this.player=!0,this.attCount=o.mV,this.defCount=o.CT}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const n=class{async getPlayer(){throw new Error("Not implemented")}savePlayer(e){throw new Error("Not implemented")}async getAvatarList(){throw new Error("Not implemented")}};var o=r(350),i=r(969);class s{constructor(e,t=0,r=0,n=""){this.name=e,this.avatar=n,this.wins=t,this.loses=r}}class a{constructor(e){return new i.Player(e.name,e.wins,e.loses,e.avatar,!0,this.health=o.vK,o.mV,o.CT)}}class c{constructor(e){return new s(e.name,e.wins,e.loses,e.avatar)}}const u="player";class l{constructor(e,t){this.repository=e,this.storageRepository=t}reduce(){throw new Error("reduce() must be implemented in subclass")}}class h extends l{constructor(e,t){super(e,t),this.player=null,this.state=this.createDefaultSettingState()}reduce(e){this.player.name=e.characterName,this.repository.savePlayer(this.player)}async loadPlayer(){const e=await this.repository.getPlayer();return this.player=e,e}toggleEdit(){return this.state={...this.state,isSave:!this.state.isSave},this.state}createDefaultSettingState(){return{name:"Edit",characterName:"",isLoading:!0,error:null}}restoreState(){const e=this.storageRepository.getItem("rootState",!0);e&&(this.state=e)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}var p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},p(e,t)};function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function f(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function v(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function g(e){return"function"==typeof e}function w(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var S=w(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function x(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var E=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=m(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(g(c))try{c()}catch(e){o=e instanceof S?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=m(u),h=l.next();!h.done;h=l.next()){var p=h.value;try{L(p)}catch(e){o=null!=o?o:[],e instanceof S?o=v(v([],y(o)),y(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}if(o)throw new S(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)L(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&x(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&x(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),C=E.EMPTY;function _(e){return e instanceof E||e&&"closed"in e&&g(e.remove)&&g(e.add)&&g(e.unsubscribe)}function L(e){g(e)?e():e.unsubscribe()}var A=null,I=null,$=void 0,P=!1,k=!1,T={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=T.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,v([e,t],y(r))):setTimeout.apply(void 0,v([e,t],y(r)))},clearTimeout:function(e){var t=T.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function O(e){T.setTimeout(function(){if(!A)throw e;A(e)})}function N(){}var V=F("C",void 0,void 0);function F(e,t,r){return{kind:e,value:t,error:r}}var j=null;function q(e){if(P){var t=!j;if(t&&(j={errorThrown:!1,error:null}),e(),t){var r=j,n=r.errorThrown,o=r.error;if(j=null,n)throw o}}else e()}var G=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,_(t)&&t.add(r)):r.destination=B,r}return d(t,e),t.create=function(e,t,r){return new M(e,t,r)},t.prototype.next=function(e){this.isStopped?z(function(e){return F("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?z(F("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?z(V,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(E),D=Function.prototype.bind;function H(e,t){return D.call(e,t)}var R=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Z(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Z(e)}else Z(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Z(e)}},e}(),M=function(e){function t(t,r,n){var o,i,s=e.call(this)||this;return g(t)||!t?o={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&k?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&H(t.next,i),error:t.error&&H(t.error,i),complete:t.complete&&H(t.complete,i)}):o=t,s.destination=new R(o),s}return d(t,e),t}(G);function Z(e){var t;P?(t=e,P&&j&&(j.errorThrown=!0,j.error=t)):O(e)}function z(e,t){var r=I;r&&T.setTimeout(function(){return r(e,t)})}var B={closed:!0,next:N,error:function(e){throw e},complete:N},J="function"==typeof Symbol&&Symbol.observable||"@@observable";function Y(e){return e}var U=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,o=this,i=(n=e)&&n instanceof G||function(e){return e&&g(e.next)&&g(e.error)&&g(e.complete)}(n)&&_(n)?e:new M(e,t,r);return q(function(){var e=o,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Q(t))(function(t,n){var o=new M({next:function(t){try{e(t)}catch(e){n(e),o.unsubscribe()}},error:n,complete:t});r.subscribe(o)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[J]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?Y:1===r.length?r[0]:function(e){return r.reduce(function(e,t){return t(e)},e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=Q(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function Q(e){var t;return null!==(t=null!=e?e:$)&&void 0!==t?t:Promise}var X=w(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),K=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return d(t,e),t.prototype.lift=function(e){var t=new W(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new X},t.prototype.next=function(e){var t=this;q(function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=m(t.currentObservers),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}})},t.prototype.error=function(e){var t=this;q(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;q(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,o=r.isStopped,i=r.observers;return n||o?C:(this.currentObservers=null,i.push(e),new E(function(){t.currentObservers=null,x(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,o=t.isStopped;r?e.error(n):o&&e.complete()},t.prototype.asObservable=function(){var e=new U;return e.source=this,e},t.create=function(e,t){return new W(e,t)},t}(U),W=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return d(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:C},t}(K);class ee{constructor(e,t){this.model=t,this.fragmentState=e,this.container=null,this.subscriptions=[],this.intent$=new K}async createView(){throw new Error("createView() must be implemented in subclass")}updateView(){throw new Error("updateView() must be implemented in subclass")}subscribe(e){const t=e.subscribe(e=>this.intent$.next(e));this.subscriptions.push(t)}intent(){throw new Error("intent() must be implemented in subclass")}}var te=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function re(e){return g(null==e?void 0:e.then)}function ne(e){return g(e[J])}function oe(e){return Symbol.asyncIterator&&g(null==e?void 0:e[Symbol.asyncIterator])}function ie(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var se="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ae(e){return g(null==e?void 0:e[se])}function ce(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(e,t){o[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||a(e,t)})},t&&(n[e]=t(n[e])))}function a(e,t){try{(r=o[e](t)).value instanceof b?Promise.resolve(r.value.v).then(c,u):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,function(){var t,r,n;return f(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,b(t.read())];case 3:return r=o.sent(),n=r.value,r.done?[4,b(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,b(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function ue(e){return g(null==e?void 0:e.getReader)}function le(e){if(e instanceof U)return e;if(null!=e){if(ne(e))return o=e,new U(function(e){var t=o[J]();if(g(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(te(e))return n=e,new U(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()});if(re(e))return r=e,new U(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,O)});if(oe(e))return he(e);if(ae(e))return t=e,new U(function(e){var r,n;try{for(var o=m(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.complete()});if(ue(e))return he(ce(e))}var t,r,n,o;throw ie(e)}function he(e){return new U(function(t){(function(e,t){var r,n,o,i,s,a,c,u;return s=this,a=void 0,u=function(){var s,a;return f(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=m(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,o){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,o,(t=e[r](t)).done,t.value)})}}}(e),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new((c=void 0)||(c=Promise))(function(e,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function n(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c(function(e){e(o)})).then(r,n)}o((u=u.apply(s,a||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function pe(e){return function(t){if(function(e){return g(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}function de(e,t,r,n,o){return new fe(e,t,r,n,o)}var fe=function(e){function t(t,r,n,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return d(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(G);function me(e,t){return pe(function(r,n){var o=0;r.subscribe(de(n,function(r){n.next(e.call(t,r,o++))}))})}function ye(e,t,r,n,o){void 0===n&&(n=0),void 0===o&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function ve(e,t,r){return void 0===r&&(r=1/0),g(t)?ve(function(r,n){return me(function(e,o){return t(r,e,n,o)})(le(e(r,n)))},r):("number"==typeof t&&(r=t),pe(function(t,n){return function(e,t,r,n){var o=[],i=0,s=0,a=!1,c=function(){!a||o.length||i||t.complete()},u=function(e){return i<n?l(e):o.push(e)},l=function(e){i++;var a=!1;le(r(e,s++)).subscribe(de(t,function(e){t.next(e)},function(){a=!0},void 0,function(){if(a)try{i--;for(var e=function(){var e=o.shift();l(e)};o.length&&i<n;)e();c()}catch(e){t.error(e)}}))};return e.subscribe(de(t,u,function(){a=!0,c()})),function(){}}(t,n,e,r)}))}var be=Array.isArray;var ge=["addListener","removeListener"],we=["addEventListener","removeEventListener"],Se=["on","off"];function xe(e,t,r,n){if(g(r)&&(n=r,r=void 0),n)return xe(e,t,r).pipe((o=n,me(function(e){return function(e,t){return be(t)?e.apply(void 0,v([],y(t))):e(t)}(o,e)})));var o,i=y(function(e){return g(e.addEventListener)&&g(e.removeEventListener)}(e)?we.map(function(n){return function(o){return e[n](t,o,r)}}):function(e){return g(e.addListener)&&g(e.removeListener)}(e)?ge.map(Ee(e,t)):function(e){return g(e.on)&&g(e.off)}(e)?Se.map(Ee(e,t)):[],2),s=i[0],a=i[1];if(!s&&te(e))return ve(function(e){return xe(e,t,r)})(le(e));if(!s)throw new TypeError("Invalid event target");return new U(function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return s(t),function(){return a(t)}})}function Ee(e,t){return function(r){return function(n){return e[r](t,n)}}}var Ce=new U(function(e){return e.complete()});function _e(e){return e[e.length-1]}function Le(e,t){return void 0===t&&(t=0),pe(function(r,n){r.subscribe(de(n,function(r){return ye(n,e,function(){return n.next(r)},t)},function(){return ye(n,e,function(){return n.complete()},t)},function(r){return ye(n,e,function(){return n.error(r)},t)}))})}function Ae(e,t){return void 0===t&&(t=0),pe(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Ie(e,t){if(!e)throw new Error("Iterable cannot be null");return new U(function(r){ye(r,t,function(){var n=e[Symbol.asyncIterator]();ye(r,t,function(){n.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}function $e(e,t){return t?function(e,t){if(null!=e){if(ne(e))return function(e,t){return le(e).pipe(Ae(t),Le(t))}(e,t);if(te(e))return function(e,t){return new U(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}(e,t);if(re(e))return function(e,t){return le(e).pipe(Ae(t),Le(t))}(e,t);if(oe(e))return Ie(e,t);if(ae(e))return function(e,t){return new U(function(r){var n;return ye(r,t,function(){n=e[se](),ye(r,t,function(){var e,t,o;try{t=(e=n.next()).value,o=e.done}catch(e){return void r.error(e)}o?r.complete():r.next(t)},0,!0)}),function(){return g(null==n?void 0:n.return)&&n.return()}})}(e,t);if(ue(e))return function(e,t){return Ie(ce(e),t)}(e,t)}throw ie(e)}(e,t):le(e)}function Pe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=function(e){return(t=_e(e))&&g(t.schedule)?e.pop():void 0;var t}(e),n=function(e){return"number"==typeof _e(e)?e.pop():1/0}(e),o=e;return o.length?1===o.length?le(o[0]):function(e){return void 0===e&&(e=1/0),ve(Y,e)}(n)($e(o,r)):Ce}class ke{constructor(e="app"){this.namespace=e,this.changePlayer$=new K}getItem(e){const t=localStorage.getItem(`${this.namespace}:${e}`);if(!t)return null;const r=JSON.parse(t);return Promise.resolve(Object.assign(new s,r))}setItem(e,t){localStorage.setItem(`${this.namespace}:${e}`,JSON.stringify(t)),this.changePlayer$.next({key:e,value:t})}removeItem(e){localStorage.removeItem(`${this.namespace}:${e}`)}}class Te{saveCharacter(e){}}class Oe extends l{reduce(e){const t=new i.Player(e.characterName);this.repository.saveCharacter(t)}}var Ne=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return d(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(K);class Ve extends l{constructor(e,t=null){super(e,t),this.character$=new Ne(null),$e(this.repository.getCharacter()).subscribe(e=>{this.character$.next(e)}),this.repository.characterChanges$.subscribe(e=>{this.character$.next(e)})}}class Fe{async getCharacter(){throw new Error("getCharacter() must be implemented in subclass")}}function je(e,t){return pe(function(r,n){var o=0;r.subscribe(de(n,function(r){return e.call(t,r,o++)&&n.next(r)}))})}class qe{getItem(e,t=!1){throw new Error("Not implemented")}setItem(e,t,r=!1){throw new Error("Not implemented")}removeItem(e,t=!1){throw new Error("Not implemented")}}const{Hero:Ge}=r(711),{Player:De}=r(969);class He{constructor(e=new De,t=new Ge,r=[]){this.player=e,this.antyPlayer=t,this.playerScor=e.health,this.antyPlayerScor=t.health,this.playerAttakeZoneCount=e.attCount,this.playerDefenceZoneCount=e.defCount,this.battleLog=r}}class Re extends l{constructor(e,t,r){super(e,t),this.battleInteractor=r,this.player=null,this.battle=new He,this.player$=new Ne(null),this.battle$=new K,$e(this.repository.getPlayer()).subscribe(e=>{this.player$.next(e)}),this.repository.playerChanges$.subscribe(e=>{this.player$.next(e)})}attackSession(){console.log("batt ses",this.battleInteractor.attackSession(null,null))}async loadPlayer(){const e=await this.repository.getPlayer();return this.player=e,this.battle.player=this.player,e}}class Me{async getPlayer(){throw new Error("getPlayer() must be implemented in subclass")}saveBattleResalt(){throw new Error("saveBattleResalt() must be implemented in subclass")}}var Ze=r(711);class ze{constructor(e=[],t=[],r=[]){this.attackZoneList=e,this.defenceZoneList=t,this.superAttackZoneList=r}}class Be{createEnemy(){return new Ze.Hero}getEnemyDisposition(){return Array()}attackSession(e,t){const r=new ze(["LEGS","BODY","BELLY"],["BODY"],["BELLY"]),n=new ze(["BELLY","LEGS"],["LEGS","HEAD"],[]),i=e=>`** attacked && to ${o.Qx[e].name} `,s=e=>`and deal ${e} damage.`,a=(e,t)=>i(e)+(t.defenceZoneList.includes(e)?(e=>`bat && was able to protected his ${o.Qx[e].name}`)(e):s(o.J_));let c=r.attackZoneList.reduce((e,t)=>(e.log.push(a(t,n)),e.damage=n.defenceZoneList.includes(t)?e.damage:e.damage+o.J_,e),{log:[],damage:0});r.superAttackZoneList.length>0&&(c=r.superAttackZoneList.reduce((e,t)=>(e.log.push(i(t)+s(1.5*o.J_)),e.damage=e.damage+1.5*o.J_,e),c));let u=n.attackZoneList.reduce((e,t)=>(e.log.push(a(t,n)),e.damage=n.defenceZoneList.includes(t)?e.damage:e.damage+o.J_,e),{log:[],damage:0});return n.superAttackZoneList.length>0&&(u=n.superAttackZoneList.reduce((e,t)=>(e.log.push(i(t)+s(1.5*o.J_)),e.damage=e.damage+1.5*o.J_,e),u)),{player:c,enemy:u}}}const Je=new class{constructor(){this.services=new Map}register(e,t){this.services.set(e,t)}resolve(e){return this.services.get(e)}};Je.register(ke,new ke),Je.register(Be,new Be),Je.register(qe,new class extends qe{constructor(e="app"){super(),this.namespace=e}getItem(e,t=!1){const r=(t?sessionStorage:localStorage).getItem(`${this.namespace}:${e}`);return r?JSON.parse(r):null}setItem(e,t,r=!1){(r?sessionStorage:localStorage).setItem(`${this.namespace}:${e}`,JSON.stringify(t))}removeItem(e,t=!1){(t?sessionStorage:localStorage).removeItem(`${this.namespace}:${e}`)}}(Je.resolve(ke))),Je.register(n,new class extends n{constructor(e){super(),this.apiClient=e}async getPlayer(){const e=await this.apiClient.getItem(u);return new a(e)}savePlayer(e){this.apiClient.setItem(u,new c(e))}async getAvatarList(){}}(Je.resolve(ke),Je.resolve(ke))),Je.register(Te,new class extends Te{constructor(e){super(),this.apiClaent=e}saveCharacter(e){this.apiClaent.setItem(u,new c(e))}}(Je.resolve(ke))),Je.register(Fe,new class extends Fe{constructor(e){super(),this.apiClient=e,this.characterChanges$=this.apiClient.changePlayer$.pipe(je(e=>e.key===u),me(e=>new a(e.value)))}async getCharacter(){const e=await this.apiClient.getItem(u);return new a(e)}}(Je.resolve(ke))),Je.register(Me,new class extends Me{constructor(e){super(),this.apiClient=e,this.playerChanges$=this.apiClient.changePlayer$.pipe(je(e=>e.key===u),me(e=>new a(e.value)))}async getPlayer(){const e=await this.apiClient.getItem(u);return new a(e)}saveBattleResalt(){}}(Je.resolve(ke))),Je.register(h,new h(Je.resolve(n),Je.resolve(qe))),Je.register(Oe,new Oe(Je.resolve(Te))),Je.register(Ve,new Ve(Je.resolve(Fe))),Je.register("RootModel",new class extends l{constructor(e,t){super(e,t),this.state=this.createScreenState(),this.intent$=new K,this.bindRootIntent(document.querySelector("body"))}init(){""===location.hash||"#/"===location.hash?this.clearState():this.restoreState(),this.intent$.subscribe(e=>{e.type.startsWith("NAVIGATE")&&(this.updateScreen(e),this.saveState())});const e=location.hash.replace("#","");e?this.intent$.next({type:"NAVIGATE",path:e}):this.intent$.next({type:"NAVIGATE",path:"/"})}async updateScreen(e){switch(e.path){case"/":try{this.state.isLoading=!0;const e="ENTER";this.state={...this.state,screen:e,isLoading:!1,error:null}}catch(e){this.state={...this.state,isLoading:!1,error:e.message}}break;case"/main":this.state={...this.state,name:"Main",withHeader:!0,withFooter:!1,fragment:"mainFragment"};break;case"/battle":this.state={...this.state,name:"Battle",withHeader:!0,withFooter:!0,fragment:"battleFragment"};break;case"/setting":this.state={...this.state,name:"Setting",withHeader:!0,withFooter:!1,fragment:"settingFragment"},this.currentFragment&&this.currentFragment.unmount();break;case"/character":this.state={...this.state,name:"Character",withHeader:!0,withFooter:!1,fragment:"characterFragment"}}this.render(this.state),this.saveState()}createScreenState(){return{screen:"DEFAULT",name:"Welcome",withHeader:!1,withFooter:!1,isLoading:!0,error:null,fragment:null}}bindRootIntent(e){const t=[],r=e.querySelector(".main-button");r&&t.push(xe(r,"click").pipe(me(()=>({type:"NAVIGATE",path:"/main"}))));const n=e.querySelector(".setting-button");n&&t.push(xe(n,"click").pipe(me(()=>({type:"NAVIGATE",path:"/setting"}))));const o=e.querySelector(".character-button");o&&t.push(xe(o,"click").pipe(me(()=>({type:"NAVIGATE",path:"/character"})))),t.length>0&&Pe(...t).subscribe(e=>this.intent$.next(e))}render(e){document.querySelector("footer").classList.toggle("hidden",!this.state.withFooter);const t=document.querySelector("header");t.classList.toggle("hidden",!this.state.withHeader),t.querySelector(".screen-name").textContent=e.name}restoreState(){const e=this.storageRepository.getItem("rootState",!0);e&&(this.state=e)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}(null,Je.resolve(qe))),Je.register(Re,new Re(Je.resolve(Me),Je.resolve(qe),Je.resolve(Be))),Je.register("/setting",new class extends ee{constructor(e,t){super(e,t),this.fragmentState={isSave:!1},this.player=null,this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.player.name=e.value),"SAVE"===e.type&&(this.model.reduce(e),this.fragmentState={...this.fragmentState,isSave:!this.fragmentState.isSave},this.updateView(),this.fragmentState.isSave&&this.model.reduce(e))})}async createView(){this.player||(this.player=await this.model.loadPlayer());let e=null,t=null,r=null,n=null;const o=document.createDocumentFragment(),i=document.createElement("div");i.classList.add("main-container"),e=document.createElement("label"),e.textContent="Player Name:",r=document.createElement("span"),t=document.createElement("input"),t.type="text",t.name="character-name",r.classList.add("character-name"),n=document.createElement("button"),n.textContent=this.fragmentState.isSave?"Save":"Edit",t.value=this.player.name,r.textContent=this.player.name,t.classList.toggle("hidden",!this.fragmentState.isSave),r.classList.toggle("hidden",this.fragmentState.isSave),e.appendChild(r),e.appendChild(t),i.appendChild(e),i.appendChild(n);const s=xe(t,"input").pipe(me(e=>({type:"TEXT_CHANGE",value:e.target.value}))),a=xe(n,"click").pipe(me(()=>({type:"SAVE",characterName:this.player.name})));return this.subscribe(Pe(s,a)),o.appendChild(i),o}updateView(){let e=document.querySelector(".main-container button"),t=document.querySelector(".main-container input"),r=document.querySelector(".main-container .character-name");e.textContent=this.fragmentState.isSave?"Save":"Edit",t.value=`${this.player.name}`,r.textContent=this.player.name,t.classList.toggle("hidden",!this.fragmentState.isSave),r.classList.toggle("hidden",this.fragmentState.isSave)}}(null,Je.resolve(h))),Je.register("/main",new class extends ee{async createView(){const e=document.createDocumentFragment();let t=document.createElement("div");t.classList.add("main-container");let r=document.createElement("button");return r.classList.add("battle-button"),r.textContent="Fight!",t.appendChild(r),e.appendChild(t),this.subscribe(xe(r,"click").pipe(me(()=>({type:"NAVIGATE",path:"/battle"})))),e}}),Je.register("/character",new class extends ee{constructor(e,t){super(e,t),this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.characterName=e.value),"SAVE"===e.type&&this.model.reduce(e)})}async createView(){const e=document.createDocumentFragment();let t=document.createElement("div");t.classList.add("main-container");const r=await(0,o.mF)(this.model.character$.value?.avatar||"");let n=document.createElement("span");n.classList.add("character-name"),n.textContent=this.model.character$.value?.name||"";let i=document.createElement("span");i.classList.add("character-wins"),i.textContent=`wins: ${this.model.character$.value?.wins||0}'`;let s=document.createElement("span");return s.classList.add("character-loses"),s.textContent=`loses: ${this.model.character$.value?.loses||0}`,t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(s),e.appendChild(t),e}updateView(e){let t=document.querySelector(".character-loses"),r=document.querySelector(".character-wins");document.querySelector(".character-name").textContent=e.name,r.textContent=`wins: ${e.wins}`,t.textContent=`loses: ${e.loses}`}mount(){this.subscriptions.push(this.model.character$.subscribe(e=>this.updateView(e)))}unmount(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[],this.container=null}}(null,Je.resolve(Ve))),Je.register("/battle",new class extends ee{constructor(e,t,r){super(e,t),this.player=null,this.intent$.subscribe(e=>{"GAME"===e.type&&this.model.attackSession()})}async createView(){this.player||(this.player=await this.model.loadPlayer());const e=document.createDocumentFragment();let t=null,r=null,n=null,i=null,s=null,a=null,c=null,u=null,l=null;l=document.createElement("div"),l.classList.add("main-container"),t=document.createElement("div"),t.classList.add("player-container"),r=document.createElement("div"),r.classList.add("enemy-container"),t.appendChild(await this.createAttendeeView(this.player)),r.appendChild(await this.createAttendeeView({name:"enemy",avatar:"./assets/images/lazy.png",health:150})),i=document.createElement("span"),i.textContent="Please pick 2 Attack zone and 3 Defence zone",a=document.createElement("div"),a.classList.add("checkbox-container"),a.classList.add("defence"),s=document.createElement("div"),s.classList.add("checkbox-container"),s.classList.add("attack"),a.appendChild(this.createCheckbox(o.Qx,"Defence")),s.appendChild(this.createCheckbox(o.Qx,"Attack")),n=document.createElement("div"),n.classList.add("disposition-container"),c=document.createElement("form"),c.classList.add("checkbox-form"),u=document.createElement("button"),u.textContent="Attake!";const h=xe(u,"click").pipe(me(()=>({type:"GAME"})));return this.subscribe(Pe(h)),n.appendChild(i),c.appendChild(s),c.appendChild(a),n.appendChild(c),n.appendChild(u),l.appendChild(t),l.appendChild(n),l.appendChild(r),e.appendChild(l),e}async createAttendeeView(e){const t=document.createDocumentFragment();let r=null,n=null,i=null,s=null,a=null,c=null;return r=document.createElement("h6"),r.textContent=e.name,n=await(0,o.mF)(e.avatar||""),i=document.createElement("div"),i.classList.add("score-line"),s=document.createElement("div"),c=document.createElement("span"),c.classList.add("current-score"),c.textContent=e.health,s.appendChild(c),s.append(" / "),a=document.createElement("span"),a.textContent=e.health,s.appendChild(a),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(s),t}createCheckbox(e,t){const r=document.createDocumentFragment();let n=document.createElement("p");n.textContent=`${t} Zones`,r.appendChild(n);for(const n of Object.values(e)){const e=document.createElement("label"),o=document.createElement("input");o.type="checkbox",o.value=n.name,o.name=t;const i=document.createTextNode(n.name);"Attack"===t?(e.appendChild(o),e.insertBefore(i,o)):(e.appendChild(o),e.appendChild(i)),r.appendChild(e)}return r}updateView(e){const t=document.querySelector(".player-container"),r=t.querySelector("h6"),n=t.querySelector("img");n.src!==e.avatar&&(n.src=e.avatar),r.textContent=e.name}updateScor(e){let t=document.querySelector(".character-loses"),r=document.querySelector(".character-wins");document.querySelector(".character-name").textContent=e.name,r.textContent=`wins: ${e.wins}`,t.textContent=`loses: ${e.loses}`}updateLogs(e){const t=document.querySelector(".log-list");for(let r=t.querySelectorAll("li").length;r<e.length;r+=1){let n=document.createElement("li");n.textContent=e[r],t.appendChild(n)}}mount(){this.subscriptions.push(this.model.player$.subscribe(e=>this.updateView(e)))}unmount(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[],this.container=null}}(null,Je.resolve(Re))),Je.register("/",new class extends ee{constructor(e,t){super(e,t),this.characterName="",this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.characterName=e.value),"SAVE"===e.type&&this.model.reduce(e)})}async createView(){const e=document.createDocumentFragment(),t=document.createElement("h1");t.textContent="Create Your Character";const r=document.createElement("label");r.textContent="Character Name";const n=document.createElement("input");n.type="text",n.value=this.characterName,r.appendChild(n);const o=xe(n,"input").pipe(me(e=>({type:"TEXT_CHANGE",value:e.target.value}))),i=document.createElement("button");i.textContent="Create character!",e.appendChild(t),e.appendChild(r),e.appendChild(i);const s=xe(i,"click").pipe(me(()=>({type:"NAVIGATE",type2:"MAIN_SCREEN_GO",path:"/main"}))),a=xe(i,"click").pipe(me(()=>({type:"SAVE",characterName:this.characterName})));return this.subscribe(Pe(o,a,s)),e}}(null,Je.resolve(Oe)));const Ye=document.querySelector("main"),Ue=new class{constructor(e,t){this.container=e,this.di=t,this.currentFragment=null,this.fragments={},this.rootModel=this.di.resolve("RootModel"),window.addEventListener("hashchange",()=>{this.navigate(location.hash.replace("#","")||"/",!1)})}async navigate(e,t=!0){if(!this.fragments[e]){const t=this.di.resolve(e);this.fragments[e]=t,t.intent$&&t.intent$.subscribe(e=>this.rootModel.intent$.next(e))}this.currentFragment&&this.currentFragment.unmount&&this.currentFragment.unmount();const r=this.fragments[e];this.container.innerHTML="",this.currentFragment=r,r.createView().then(e=>{this.container.appendChild(e),r.mount&&r.mount()}).catch(e=>console.error(e)),t&&history.pushState({},"","#"+e)}init(){this.rootModel.intent$.subscribe(e=>{e.type.startsWith("NAVIGATE")&&this.navigate(e.path)}),this.rootModel.init()}}(Ye,Je);Ue.init()})();