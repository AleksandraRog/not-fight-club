(()=>{"use strict";var e={350:(e,t,r)=>{r.d(t,{CT:()=>o,J_:()=>a,Qx:()=>s,To:()=>c,mF:()=>l,mV:()=>i,vK:()=>n});const n=150,a=10,i=1,o=2,s={HEAD:{id:1,name:"Head"},NECK:{id:2,name:"Neck"},BODY:{id:3,name:"Body"},BELLY:{id:4,name:"Belly"},LEGS:{id:5,name:"Legs"}},c={1:{name:"Knight",attCount:1,defCount:3},2:{name:"Warrior",attCount:1,defCount:2},3:{name:"Warrior 2",attCount:2,defCount:1},4:{name:"Warrior 3",attCount:2,defCount:2}},l=e=>new Promise((t,r)=>{const n=new Image;n.onload=()=>t(n),n.onerror=r,n.src=e,n.alt="avatar"})},711:(e,t,r)=>{r.r(t),r.d(t,{Hero:()=>a});var n=r(350);class a{constructor(e="",t=0,r=0,a="",i=!1,o=n.vK,s=0,c=0){this.name=e,this.avatar=a,this.wins=t,this.loses=r,this.player=i,this.health=o,this.attCount=s,this.defCount=c}}},969:(e,t,r)=>{r.r(t),r.d(t,{Player:()=>i});var n=r(711),a=r(350);class i extends n.Hero{constructor(e,t,r,n,i,o,s,c){super(e,t,r,n,i,o,s,c),this.avatar="./assets/avatars/avatar1.jpg",this.player=!0,this.attCount=a.mV,this.defCount=a.CT}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const n=class{async getPlayer(){throw new Error("Not implemented")}savePlayer(e){throw new Error("Not implemented")}async getAvatarList(){throw new Error("Not implemented")}};var a=r(350),i=r(969);class o{constructor(e,t=0,r=0,n=""){this.name=e,this.avatar=n,this.wins=t,this.loses=r}}class s{constructor(e){return new i.Player(e.name,e.wins,e.loses,e.avatar,!0,this.health=a.vK,a.mV,a.CT)}}class c{constructor(e){return new o(e.name,e.wins,e.loses,e.avatar)}}const l="player";class u{constructor(e,t){this.repository=e,this.storageRepository=t}reduce(){throw new Error("reduce() must be implemented in subclass")}}class h extends u{constructor(e,t){super(e,t),this.player=null,this.state=this.createDefaultSettingState()}reduce(e){this.player.name=e.characterName,this.repository.savePlayer(this.player)}async loadPlayer(){const e=await this.repository.getPlayer();return this.player=e,e}toggleEdit(){return this.state={...this.state,isSave:!this.state.isSave},this.state}createDefaultSettingState(){return{name:"Edit",characterName:"",isLoading:!0,error:null}}restoreState(){const e=this.storageRepository.getItem("rootState",!0);e&&(this.state=e)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}var p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},p(e,t)};function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function f(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return o}function b(e,t,r){if(r||2===arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function v(e){return this instanceof v?(this.v=e,this):new v(e)}function g(e){return"function"==typeof e}function w(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var S=w(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function C(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var x=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var o=m(i),s=o.next();!s.done;s=o.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(g(c))try{c()}catch(e){a=e instanceof S?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=m(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{k(p)}catch(e){a=null!=a?a:[],e instanceof S?a=b(b([],y(a)),y(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(a)throw new S(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)k(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&C(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&C(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),E=x.EMPTY;function L(e){return e instanceof x||e&&"closed"in e&&g(e.remove)&&g(e.add)&&g(e.unsubscribe)}function k(e){g(e)?e():e.unsubscribe()}var _=null,A=null,I=void 0,$=!1,T=!1,P={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=P.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,b([e,t],y(r))):setTimeout.apply(void 0,b([e,t],y(r)))},clearTimeout:function(e){var t=P.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function O(e){P.setTimeout(function(){if(!_)throw e;_(e)})}function N(){}var D=V("C",void 0,void 0);function V(e,t,r){return{kind:e,value:t,error:r}}var F=null;function j(e){if($){var t=!F;if(t&&(F={errorThrown:!1,error:null}),e(),t){var r=F,n=r.errorThrown,a=r.error;if(F=null,n)throw a}}else e()}var Z=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,L(t)&&t.add(r)):r.destination=z,r}return d(t,e),t.create=function(e,t,r){return new H(e,t,r)},t.prototype.next=function(e){this.isStopped?B(function(e){return V("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?B(V("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?B(D,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(x),M=Function.prototype.bind;function q(e,t){return M.call(e,t)}var R=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){G(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){G(e)}else G(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){G(e)}},e}(),H=function(e){function t(t,r,n){var a,i,o=e.call(this)||this;return g(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:o&&T?((i=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},a={next:t.next&&q(t.next,i),error:t.error&&q(t.error,i),complete:t.complete&&q(t.complete,i)}):a=t,o.destination=new R(a),o}return d(t,e),t}(Z);function G(e){var t;$?(t=e,$&&F&&(F.errorThrown=!0,F.error=t)):O(e)}function B(e,t){var r=A;r&&P.setTimeout(function(){return r(e,t)})}var z={closed:!0,next:N,error:function(e){throw e},complete:N},J="function"==typeof Symbol&&Symbol.observable||"@@observable";function U(e){return e}var Q=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,a=this,i=(n=e)&&n instanceof Z||function(e){return e&&g(e.next)&&g(e.error)&&g(e.complete)}(n)&&L(n)?e:new H(e,t,r);return j(function(){var e=a,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?a._subscribe(i):a._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=K(t))(function(t,n){var a=new H({next:function(t){try{e(t)}catch(e){n(e),a.unsubscribe()}},error:n,complete:t});r.subscribe(a)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[J]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?U:1===r.length?r[0]:function(e){return r.reduce(function(e,t){return t(e)},e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=K(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function K(e){var t;return null!==(t=null!=e?e:I)&&void 0!==t?t:Promise}var Y=w(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),W=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return d(t,e),t.prototype.lift=function(e){var t=new X(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Y},t.prototype.next=function(e){var t=this;j(function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var a=m(t.currentObservers),i=a.next();!i.done;i=a.next())i.value.next(e)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}})},t.prototype.error=function(e){var t=this;j(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;j(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,a=r.isStopped,i=r.observers;return n||a?E:(this.currentObservers=null,i.push(e),new x(function(){t.currentObservers=null,C(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,a=t.isStopped;r?e.error(n):a&&e.complete()},t.prototype.asObservable=function(){var e=new Q;return e.source=this,e},t.create=function(e,t){return new X(e,t)},t}(Q),X=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return d(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:E},t}(W);class ee{constructor(e,t){this.model=t,this.fragmentState=e,this.container=null,this.subscriptions=[],this.intent$=new W}async createView(){throw new Error("createView() must be implemented in subclass")}updateView(){throw new Error("updateView() must be implemented in subclass")}subscribe(e){const t=e.subscribe(e=>this.intent$.next(e));this.subscriptions.push(t)}intent(){throw new Error("intent() must be implemented in subclass")}}var te=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function re(e){return g(null==e?void 0:e.then)}function ne(e){return g(e[J])}function ae(e){return Symbol.asyncIterator&&g(null==e?void 0:e[Symbol.asyncIterator])}function ie(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var oe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function se(e){return g(null==e?void 0:e[oe])}function ce(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){a[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||s(e,t)})},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=a[e](t)).value instanceof v?Promise.resolve(r.value.v).then(c,l):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function(){var t,r,n;return f(this,function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,v(t.read())];case 3:return r=a.sent(),n=r.value,r.done?[4,v(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,v(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function le(e){return g(null==e?void 0:e.getReader)}function ue(e){if(e instanceof Q)return e;if(null!=e){if(ne(e))return a=e,new Q(function(e){var t=a[J]();if(g(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(te(e))return n=e,new Q(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()});if(re(e))return r=e,new Q(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,O)});if(ae(e))return he(e);if(se(e))return t=e,new Q(function(e){var r,n;try{for(var a=m(t),i=a.next();!i.done;i=a.next()){var o=i.value;if(e.next(o),e.closed)return}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}e.complete()});if(le(e))return he(ce(e))}var t,r,n,a;throw ie(e)}function he(e){return new Q(function(t){(function(e,t){var r,n,a,i,o,s,c,l;return o=this,s=void 0,l=function(){var o,s;return f(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=m(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,a,(t=e[r](t)).done,t.value)})}}}(e),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),a={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new((c=void 0)||(c=Promise))(function(e,t){function r(e){try{a(l.next(e))}catch(e){t(e)}}function n(e){try{a(l.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof c?a:new c(function(e){e(a)})).then(r,n)}a((l=l.apply(o,s||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function pe(e){return function(t){if(function(e){return g(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}function de(e,t,r,n,a){return new fe(e,t,r,n,a)}var fe=function(e){function t(t,r,n,a,i,o){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=o,s._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return d(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Z);function me(e,t){return pe(function(r,n){var a=0;r.subscribe(de(n,function(r){n.next(e.call(t,r,a++))}))})}function ye(e,t,r,n,a){void 0===n&&(n=0),void 0===a&&(a=!1);var i=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!a)return i}function be(e,t,r){return void 0===r&&(r=1/0),g(t)?be(function(r,n){return me(function(e,a){return t(r,e,n,a)})(ue(e(r,n)))},r):("number"==typeof t&&(r=t),pe(function(t,n){return function(e,t,r,n){var a=[],i=0,o=0,s=!1,c=function(){!s||a.length||i||t.complete()},l=function(e){return i<n?u(e):a.push(e)},u=function(e){i++;var s=!1;ue(r(e,o++)).subscribe(de(t,function(e){t.next(e)},function(){s=!0},void 0,function(){if(s)try{i--;for(var e=function(){var e=a.shift();u(e)};a.length&&i<n;)e();c()}catch(e){t.error(e)}}))};return e.subscribe(de(t,l,function(){s=!0,c()})),function(){}}(t,n,e,r)}))}var ve=Array.isArray;var ge=["addListener","removeListener"],we=["addEventListener","removeEventListener"],Se=["on","off"];function Ce(e,t,r,n){if(g(r)&&(n=r,r=void 0),n)return Ce(e,t,r).pipe((a=n,me(function(e){return function(e,t){return ve(t)?e.apply(void 0,b([],y(t))):e(t)}(a,e)})));var a,i=y(function(e){return g(e.addEventListener)&&g(e.removeEventListener)}(e)?we.map(function(n){return function(a){return e[n](t,a,r)}}):function(e){return g(e.addListener)&&g(e.removeListener)}(e)?ge.map(xe(e,t)):function(e){return g(e.on)&&g(e.off)}(e)?Se.map(xe(e,t)):[],2),o=i[0],s=i[1];if(!o&&te(e))return be(function(e){return Ce(e,t,r)})(ue(e));if(!o)throw new TypeError("Invalid event target");return new Q(function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return o(t),function(){return s(t)}})}function xe(e,t){return function(r){return function(n){return e[r](t,n)}}}var Ee=new Q(function(e){return e.complete()});function Le(e){return e[e.length-1]}function ke(e,t){return void 0===t&&(t=0),pe(function(r,n){r.subscribe(de(n,function(r){return ye(n,e,function(){return n.next(r)},t)},function(){return ye(n,e,function(){return n.complete()},t)},function(r){return ye(n,e,function(){return n.error(r)},t)}))})}function _e(e,t){return void 0===t&&(t=0),pe(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Ae(e,t){if(!e)throw new Error("Iterable cannot be null");return new Q(function(r){ye(r,t,function(){var n=e[Symbol.asyncIterator]();ye(r,t,function(){n.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}function Ie(e,t){return t?function(e,t){if(null!=e){if(ne(e))return function(e,t){return ue(e).pipe(_e(t),ke(t))}(e,t);if(te(e))return function(e,t){return new Q(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}(e,t);if(re(e))return function(e,t){return ue(e).pipe(_e(t),ke(t))}(e,t);if(ae(e))return Ae(e,t);if(se(e))return function(e,t){return new Q(function(r){var n;return ye(r,t,function(){n=e[oe](),ye(r,t,function(){var e,t,a;try{t=(e=n.next()).value,a=e.done}catch(e){return void r.error(e)}a?r.complete():r.next(t)},0,!0)}),function(){return g(null==n?void 0:n.return)&&n.return()}})}(e,t);if(le(e))return function(e,t){return Ae(ce(e),t)}(e,t)}throw ie(e)}(e,t):ue(e)}function $e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=function(e){return(t=Le(e))&&g(t.schedule)?e.pop():void 0;var t}(e),n=function(e){return"number"==typeof Le(e)?e.pop():1/0}(e),a=e;return a.length?1===a.length?ue(a[0]):function(e){return void 0===e&&(e=1/0),be(U,e)}(n)(Ie(a,r)):Ee}class Te{constructor(e="app"){this.namespace=e,this.changePlayer$=new W}getItem(e){const t=localStorage.getItem(`${this.namespace}:${e}`);if(!t)return null;const r=JSON.parse(t);return Promise.resolve(Object.assign(new o,r))}setItem(e,t){localStorage.setItem(`${this.namespace}:${e}`,JSON.stringify(t)),this.changePlayer$.next({key:e,value:t})}removeItem(e){localStorage.removeItem(`${this.namespace}:${e}`)}}function Pe(e,t){return pe(function(r,n){var a=0;r.subscribe(de(n,function(r){return e.call(t,r,a++)&&n.next(r)}))})}class Oe{saveCharacter(e){}}class Ne extends u{reduce(e){const t=new i.Player(e.characterName);this.repository.saveCharacter(t)}}var De=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return d(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(W);class Ve extends u{constructor(e,t=null){super(e,t),this.character$=new De(null),Ie(this.repository.getCharacter()).subscribe(e=>{this.character$.next(e)}),this.repository.characterChanges$.subscribe(e=>{this.character$.next(e)})}}class Fe{async getCharacter(){throw new Error("getCharacter() must be implemented in subclass")}}class je{getItem(e,t=!1){throw new Error("Not implemented")}setItem(e,t,r=!1){throw new Error("Not implemented")}removeItem(e,t=!1){throw new Error("Not implemented")}}class Ze{constructor(e=[],t=[],r=[]){this.attackZoneList=e,this.defenceZoneList=t,this.superAttackZoneList=r}}const{Hero:Me}=r(711),{Player:qe}=r(969);class Re{constructor(e=new qe,t=new Me,r=[]){this.player=e,this.enemy=t,this.playerScore=this.player.health,this.enemyScore=this.enemy.health,this.playerAttackZoneCount=e.attCount,this.playerDefenceZoneCount=e.defCount,this.playerDisposition=new Ze,this.enemyDisposition=new Ze,this.battleLog=r,this.finish=!1,this.isReady=!1}}class He extends u{constructor(e,t,r){super(e,t),this.battleInteractor=r,this.player=null,this.battle=new Re,this.battle.enemy=this.createEnemy(),this.player$=new De(null),this.battle$=new W,Ie(this.repository.getPlayer()).subscribe(e=>{this.player$.next(e)}),this.repository.playerChanges$.subscribe(e=>{this.player=e,this.player$.next(e)})}async attackSession(){this.battle.enemyDisposition=this.battleInteractor.createEnemyDisposition(this.battle.enemy);const e=await this.battleInteractor.attackSession(this.battle.playerDisposition,this.battle.enemyDisposition);this.battle.playerScore-=e.player.damage,this.battle.enemyScore-=e.enemy.damage,(this.battle.playerScore<=0||this.battle.enemyScore<=0)&&(this.battle.finish=!0),e.player.log.forEach(e=>{this.battle.battleLog.push(e.replace("**",this.player.name).replace("&&",this.battle.enemy.name))}),e.enemy.log.forEach(e=>{this.battle.battleLog.push(e.replace("&&",this.player.name).replace("**",this.battle.enemy.name))}),this.battle$.next(this.battle)}async loadPlayer(){const e=await this.repository.getPlayer();return this.player=e,this.battle.player=this.player,e}createEnemy(){return this.battleInteractor.createEnemy()}createEnemyDisposition(){this.battle.enemyDisposition=this.battleInteractor.createEnemyDisposition(this.battle.enemy)}async updateTypePlayerAttack(){const e=await this.battleInteractor.updateTypeAttack(this.battle.playerDisposition);this.battle.playerDisposition=e}updatePlayerDisposition(e){const t=this.battle.playerDisposition;"Attack"===e.group&&(e.checked?this.battle.playerDisposition.attackZoneList.push(e.value.toUpperCase()):(this.battle.playerDisposition.attackZoneList=t.attackZoneList.filter(t=>t!==e.value.toUpperCase()),this.battle.playerDisposition.superAttackZoneList=t.superAttackZoneList.filter(t=>t!==e.value.toUpperCase()))),"Defence"===e.group&&(e.checked?this.battle.playerDisposition.defenceZoneList.push(e.value.toUpperCase()):this.battle.playerDisposition.defenceZoneList=t.defenceZoneList.filter(t=>t!==e.value.toUpperCase())),this.pushBattleChange()}pushBattleChange(){this.updateTypePlayerAttack();const e=this.battle.playerDisposition.attackZoneList.length,t=this.battle.playerDisposition.defenceZoneList.length,r=this.battle.playerDisposition.superAttackZoneList.length;this.battle.isReady=e+r===this.battle.playerAttackZoneCount&&t===this.battle.playerDefenceZoneCount,this.battle$.next(this.battle)}savePlayerResult(e){e.result>0?this.player.wins+=Math.abs(e.result):this.player.loses+=Math.abs(e.result),this.repository.saveBattleResalt(this.player),this.resetBattle()}resetBattle(){this.battle=new Re,this.battle.player=this.player,this.battle.enemy=this.createEnemy()}}class Ge{async getPlayer(){throw new Error("getPlayer() must be implemented in subclass")}saveBattleResalt(){throw new Error("saveBattleResalt() must be implemented in subclass")}}var Be=r(711);class ze{createEnemy(){let e=Math.floor(Math.random()*(Object.values(a.To).length+1));const t=Object.assign(new Be.Hero,a.To[e]);return t.avatar=`./assets/avatars/avatar${e+4}.jpg`,t}createEnemyDisposition(e){const t=new Set;let r;do{r=Math.floor(Math.random()*Object.values(a.Qx).length)+1,t.add(Object.keys(a.Qx).find(e=>a.Qx[e].id===r))}while(t.size<e.attCount);const n=new Set;do{r=Math.floor(Math.random()*Object.values(a.Qx).length)+1,n.add(Object.keys(a.Qx).find(e=>a.Qx[e].id===r))}while(n.size<e.defenceList);return this.updateTypeAttack(new Ze([...t],[...n]))}attackSession(e,t){const r=e,n=t,i=e=>`** attacked && to ${a.Qx[e].name} `,o=e=>`and deal ${e} damage.`,s=(e,t)=>i(e)+(t.defenceZoneList.includes(e)?(e=>`bat && was able to protected his ${a.Qx[e].name}`)(e):o(a.J_));let c=r.attackZoneList.reduce((e,t)=>(e.log.push(s(t,n)),e.damage=n.defenceZoneList.includes(t)?e.damage:e.damage+a.J_,e),{log:[],damage:0});r.superAttackZoneList.length>0&&(c=r.superAttackZoneList.reduce((e,t)=>(e.log.push(i(t).replace("attacked","criticaly attacked")+o(1.5*a.J_)),e.damage=e.damage+1.5*a.J_,e),c));let l=n.attackZoneList.reduce((e,t)=>(e.log.push(s(t,n)),e.damage=n.defenceZoneList.includes(t)?e.damage:e.damage+a.J_,e),{log:[],damage:0});return n.superAttackZoneList.length>0&&(l=n.superAttackZoneList.reduce((e,t)=>(e.log.push(i(t).replace("attacked","criticaly attacked")+o(1.5*a.J_)),e.damage=e.damage+1.5*a.J_,e),l)),{player:c,enemy:l}}updateTypeAttack(e){let t=Math.floor(50*Math.random())+1,r=e;return r.attackZoneList.length>0&&1===t&&(r.superAttackZoneList.push(r.attackZoneList.slice(-1)),r.attackZoneList.pop()),r}}const Je=new class{constructor(){this.services=new Map}register(e,t){this.services.set(e,t)}resolve(e){return this.services.get(e)}};Je.register(Te,new Te),Je.register(ze,new ze),Je.register(je,new class extends je{constructor(e="app"){super(),this.namespace=e}getItem(e,t=!1){const r=(t?sessionStorage:localStorage).getItem(`${this.namespace}:${e}`);return r?JSON.parse(r):null}setItem(e,t,r=!1){(r?sessionStorage:localStorage).setItem(`${this.namespace}:${e}`,JSON.stringify(t))}removeItem(e,t=!1){(t?sessionStorage:localStorage).removeItem(`${this.namespace}:${e}`)}}(Je.resolve(Te))),Je.register(n,new class extends n{constructor(e){super(),this.apiClient=e}async getPlayer(){const e=await this.apiClient.getItem(l);return new s(e)}savePlayer(e){this.apiClient.setItem(l,new c(e))}}(Je.resolve(Te),Je.resolve(Te))),Je.register(Oe,new class extends Oe{constructor(e){super(),this.apiClaent=e}saveCharacter(e){this.apiClaent.setItem(l,new c(e))}}(Je.resolve(Te))),Je.register(Fe,new class extends Fe{constructor(e){super(),this.apiClient=e,this.characterChanges$=this.apiClient.changePlayer$.pipe(Pe(e=>e.key===l),me(e=>new s(e.value)))}async getCharacter(){const e=await this.apiClient.getItem(l);return new s(e)}}(Je.resolve(Te))),Je.register(Ge,new class extends Ge{constructor(e){super(),this.apiClient=e,this.playerChanges$=this.apiClient.changePlayer$.pipe(Pe(e=>e.key===l),me(e=>new s(e.value)))}async getPlayer(){const e=await this.apiClient.getItem(l);return new s(e)}saveBattleResalt(e){this.apiClient.setItem(l,new c(e))}}(Je.resolve(Te))),Je.register(h,new h(Je.resolve(n),Je.resolve(je))),Je.register(Ne,new Ne(Je.resolve(Oe))),Je.register(Ve,new Ve(Je.resolve(Fe))),Je.register("RootModel",new class extends u{constructor(e,t){super(e,t),this.state=this.createScreenState(),this.intent$=new W,this.bindRootIntent(document.querySelector("body"))}init(){""===location.hash||"#/"===location.hash?this.clearState():this.restoreState(),this.intent$.subscribe(e=>{e.type.startsWith("NAVIGATE")&&(this.updateScreen(e),this.saveState())});const e=location.hash.replace("#","");e?this.intent$.next({type:"NAVIGATE",path:e}):this.intent$.next({type:"NAVIGATE",path:"/"})}async updateScreen(e){switch(e.path){case"/":try{this.state.isLoading=!0;const e="ENTER";this.state={...this.state,screen:e,isLoading:!1,error:null}}catch(e){this.state={...this.state,isLoading:!1,error:e.message}}break;case"/main":this.state={...this.state,name:"Main",withHeader:!0,withFooter:!1,fragment:"mainFragment"};break;case"/battle":this.state={...this.state,name:"Battle",withHeader:!0,withFooter:!0,fragment:"battleFragment"};break;case"/setting":this.state={...this.state,name:"Setting",withHeader:!0,withFooter:!1,fragment:"settingFragment"},this.currentFragment&&this.currentFragment.unmount();break;case"/character":this.state={...this.state,name:"Character",withHeader:!0,withFooter:!1,fragment:"characterFragment"}}this.render(this.state),this.saveState()}createScreenState(){return{screen:"DEFAULT",name:"Welcome",withHeader:!1,withFooter:!1,isLoading:!0,error:null,fragment:null}}bindRootIntent(e){const t=[],r=e.querySelector(".main-button");r&&t.push(Ce(r,"click").pipe(me(()=>({type:"NAVIGATE",path:"/main"}))));const n=e.querySelector(".setting-button");n&&t.push(Ce(n,"click").pipe(me(()=>({type:"NAVIGATE",path:"/setting"}))));const a=e.querySelector(".character-button");a&&t.push(Ce(a,"click").pipe(me(()=>({type:"NAVIGATE",path:"/character"})))),t.length>0&&$e(...t).subscribe(e=>this.intent$.next(e))}render(e){const t=document.querySelector("footer");t.classList.add("fade-in"),t.classList.toggle("show",this.state.withFooter);const r=document.querySelector("header");r.classList.add("fade-in"),r.classList.toggle("show",this.state.withHeader),r.querySelector(".screen-name").textContent=e.name}restoreState(){const e=this.storageRepository.getItem("rootState",!0);e&&(this.state=e)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}(null,Je.resolve(je))),Je.register(He,new He(Je.resolve(Ge),Je.resolve(je),Je.resolve(ze))),Je.register("/setting",new class extends ee{constructor(e,t){super(e,t),this.fragmentState={isSave:!1},this.player=null,this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.player.name=e.value),"SAVE"===e.type&&(this.model.reduce(e),this.fragmentState={...this.fragmentState,isSave:!this.fragmentState.isSave},this.updateView(),this.fragmentState.isSave&&this.model.reduce(e))})}async createView(){this.player||(this.player=await this.model.loadPlayer());let e=null,t=null,r=null,n=null;const a=document.createDocumentFragment(),i=document.createElement("div");i.classList.add("main-container"),e=document.createElement("label"),e.textContent="Player Name:",r=document.createElement("span"),t=document.createElement("input"),t.type="text",t.name="character-name",r.classList.add("character-name"),n=document.createElement("button"),n.textContent=this.fragmentState.isSave?"Save":"Edit",t.value=this.player.name,r.textContent=this.player.name,t.classList.toggle("hidden",!this.fragmentState.isSave),r.classList.toggle("hidden",this.fragmentState.isSave),e.appendChild(r),e.appendChild(t),i.appendChild(e),i.appendChild(n);const o=Ce(t,"input").pipe(me(e=>({type:"TEXT_CHANGE",value:e.target.value}))),s=Ce(n,"click").pipe(me(()=>({type:"SAVE",characterName:this.player.name})));return this.subscribe($e(o,s)),a.appendChild(i),a}updateView(){let e=document.querySelector(".main-container button"),t=document.querySelector(".main-container input"),r=document.querySelector(".main-container .character-name");e.textContent=this.fragmentState.isSave?"Save":"Edit",t.value=`${this.player.name}`,r.textContent=this.player.name,t.classList.toggle("hidden",!this.fragmentState.isSave),r.classList.toggle("hidden",this.fragmentState.isSave)}}(null,Je.resolve(h))),Je.register("/main",new class extends ee{async createView(){const e=document.createDocumentFragment();let t=document.createElement("div");t.classList.add("main-container");let r=document.createElement("button");return r.classList.add("battle-button"),r.textContent="Fight!",t.appendChild(r),e.appendChild(t),this.subscribe(Ce(r,"click").pipe(me(()=>({type:"NAVIGATE",path:"/battle"})))),e}}),Je.register("/character",new class extends ee{constructor(e,t){super(e,t),this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.characterName=e.value),"SAVE"===e.type&&this.model.reduce(e)})}async createView(){const e=document.createDocumentFragment();let t=document.createElement("div");t.classList.add("main-container");const r=await(0,a.mF)(this.model.character$.value?.avatar||"");let n=document.createElement("span");n.classList.add("character-name"),n.textContent=this.model.character$.value?.name||"";let i=document.createElement("span");i.classList.add("character-wins"),i.textContent=`wins: ${this.model.character$.value?.wins||0}'`;let o=document.createElement("span");return o.classList.add("character-loses"),o.textContent=`loses: ${this.model.character$.value?.loses||0}`,t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),e.appendChild(t),e}updateView(e){let t=document.querySelector(".character-loses"),r=document.querySelector(".character-wins");document.querySelector(".character-name").textContent=e.name,r.textContent=`wins: ${e.wins}`,t.textContent=`loses: ${e.loses}`}mount(){this.subscriptions.push(this.model.character$.subscribe(e=>this.updateView(e)))}unmount(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[],this.container=null}}(null,Je.resolve(Ve))),Je.register("/battle",new class extends ee{constructor(e,t){super(e,t),this.player=null,this.logList=null,this.intent$.subscribe(e=>{"GAME"===e.type&&this.model.attackSession(),"CHECK"===e.type&&this.model.updatePlayerDisposition(e),"SAVE"===e.type&&this.model.savePlayerResult(e)})}async createView(){document.querySelector("footer").classList.remove("show"),this.player||(this.player=await this.model.loadPlayer());const e=document.createDocumentFragment();let t=null,r=null,n=null,i=null,o=null,s=null,c=null,l=null,u=null;u=document.createElement("div"),u.classList.add("main-container"),t=document.createElement("div"),t.classList.add("player-container"),r=document.createElement("div"),r.classList.add("enemy-container"),t.appendChild(await this.createAttendeeView(this.player)),r.appendChild(await this.createAttendeeView(this.model.battle.enemy)),i=document.createElement("span"),i.textContent=`Please pick ${this.model.battle.playerAttackZoneCount} Attack zone and ${this.model.battle.playerDefenceZoneCount} Defence zone`,s=document.createElement("div"),s.classList.add("checkbox-container"),s.classList.add("defence"),o=document.createElement("div"),o.classList.add("checkbox-container"),o.classList.add("attack"),s.appendChild(this.createCheckbox(a.Qx,"Defence")),o.appendChild(this.createCheckbox(a.Qx,"Attack")),n=document.createElement("div"),n.classList.add("disposition-container"),c=document.createElement("form"),c.classList.add("checkbox-form"),l=document.createElement("button"),l.textContent="Attake!",l.disabled=!0;const h=Ce(l,"click").pipe(me(()=>({type:"GAME"}))),p=Ce(c,"change").pipe(Pe(e=>"checkbox"===e.target.type),me(e=>({type:"CHECK",group:e.target.name,value:e.target.value,checked:e.target.checked})));return this.subscribe($e(h,p)),n.appendChild(i),c.appendChild(o),c.appendChild(s),n.appendChild(c),n.appendChild(l),u.appendChild(t),u.appendChild(n),u.appendChild(r),e.appendChild(u),document.querySelector("footer").classList.add("show"),e}async createAttendeeView(e){const t=document.createDocumentFragment();let r=null,n=null,i=null,o=null,s=null,c=null;return r=document.createElement("h6"),r.textContent=e.name,n=await(0,a.mF)(e.avatar||""),i=document.createElement("div"),i.classList.add("score-line"),o=document.createElement("div"),c=document.createElement("span"),c.classList.add("current-score"),c.textContent=e.health,o.appendChild(c),o.append(" / "),s=document.createElement("span"),s.textContent=e.health,o.appendChild(s),this.createScore(e,i,c),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),t}createCheckbox(e,t){const r=document.createDocumentFragment();let n=document.createElement("p");n.textContent=`${t} Zones`,r.appendChild(n);for(const n of Object.values(e)){const e=document.createElement("label"),a=document.createElement("input");a.type="checkbox",a.value=n.name,a.name=t;const i=document.createTextNode(n.name);"Attack"===t?(e.appendChild(a),e.insertBefore(i,a)):(e.appendChild(a),e.appendChild(i)),r.appendChild(e)}return r}updateView(e){const t=document.querySelector(".player-container"),r=t.querySelector("h6"),n=t.querySelector("img");n.src!==e.avatar&&(n.src=e.avatar),r.textContent=e.name}updateScore(e,t){const r=document.querySelector("."+(e.player?"player-container":"enemy-container")),n=e.player?t.playerScore:t.enemyScore,a=Math.floor(n/e.health*100);r.querySelector(".score-line").style.background=`linear-gradient(to right, #710707 0%, #710707 ${a}%, #C4C4C4 ${a}%, #C4C4C4 100%)`,r.querySelector(".current-score").textContent=n}createScore(e,t,r){const n=e.player?this.model.battle.playerScore:this.model.battle.enemyScore,a=Math.floor(n/e.health*100);t.style.background=`linear-gradient(to right, #710707 0%, #710707 ${a}%, #C4C4C4 ${a}%, #C4C4C4 100%)`,r.textContent=n}updateButtonState(e){document.querySelector(".disposition-container button").disabled=!e.isReady||e.finish}updateLogs(e){this.logList=document.querySelector(".log-list");for(let t=this.logList.querySelectorAll("li").length;t<e.length;t+=1){let r=document.createElement("li");r.innerHTML=e[t].replace(this.model.player.name,`<strong>${this.model.player.name}</strong>`).replace(this.model.battle.enemy.name,`<strong>${this.model.battle.enemy.name}</strong>`),this.logList.appendChild(r)}}updateFinish(e){if(e.finish){const t=document.querySelector(".main-container");let r=document.createElement("div");r.classList.add("finish-message"),t.appendChild(r),r.classList.add("show"),e.playerScore>e.enemyScore?r.textContent="Congratulation with your win!":r.textContent="Maybe next time :(";const n=Ce(r,"click").pipe(me(()=>({type:"NAVIGATE",path:"/character"}))),a=Ce(r,"click").pipe(me(()=>({type:"SAVE",result:e.playerScore>e.enemyScore?1:-1})));this.subscribe($e(a,n))}}mount(){this.subscriptions.push(this.model.player$.subscribe(e=>this.updateView(e))),this.subscriptions.push(this.model.battle$.subscribe(e=>{this.updateScore(e.player,e),this.updateScore(e.enemy,e),this.updateButtonState(e),this.updateLogs(e.battleLog),this.updateFinish(e)}))}unmount(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[],0===this.model.battle.battleLog.length&&(this.logList.innerHTML="")}}(null,Je.resolve(He))),Je.register("/",new class extends ee{constructor(e,t){super(e,t),this.characterName="",this.intent$.subscribe(e=>{"TEXT_CHANGE"===e.type&&(this.characterName=e.value),"SAVE"===e.type&&this.model.reduce(e)})}async createView(){const e=document.createDocumentFragment(),t=document.createElement("h1");t.textContent="Create Your Character";const r=document.createElement("label");r.textContent="Character Name";const n=document.createElement("input");n.type="text",n.value=this.characterName,r.appendChild(n);const a=Ce(n,"input").pipe(me(e=>({type:"TEXT_CHANGE",value:e.target.value}))),i=document.createElement("button");i.textContent="Create character!",e.appendChild(t),e.appendChild(r),e.appendChild(i);const o=Ce(i,"click").pipe(me(()=>({type:"NAVIGATE",path:"/main"}))),s=Ce(i,"click").pipe(me(()=>({type:"SAVE",characterName:this.characterName})));return this.subscribe($e(a,s,o)),e}}(null,Je.resolve(Ne)));const Ue=document.querySelector("main"),Qe=new class{constructor(e,t){this.container=e,this.di=t,this.currentFragment=null,this.fragments={},this.rootModel=this.di.resolve("RootModel"),window.addEventListener("hashchange",()=>{this.navigate(location.hash.replace("#","")||"/",!1)})}async navigate(e,t=!0){if(!this.fragments[e]){const t=this.di.resolve(e);this.fragments[e]=t,t.intent$&&t.intent$.subscribe(e=>this.rootModel.intent$.next(e))}this.currentFragment&&this.currentFragment.unmount&&this.currentFragment.unmount();const r=this.fragments[e];this.container.innerHTML="",this.currentFragment=r,r.createView().then(e=>{this.container.appendChild(e),r.mount&&r.mount()}).catch(e=>console.error(e)),t&&history.pushState({},"","#"+e)}init(){this.rootModel.intent$.subscribe(e=>{e.type.startsWith("NAVIGATE")&&this.navigate(e.path)}),this.rootModel.init()}}(Ue,Je);Qe.init()})();