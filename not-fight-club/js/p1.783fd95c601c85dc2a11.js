(()=>{"use strict";const t=class{async getPlayer(){throw new Error("Not implemented")}savePlayer(t){throw new Error("Not implemented")}async getAvatarList(){throw new Error("Not implemented")}},e={HEAD:{id:1,name:"Head"},NECK:{id:2,name:"Neck"},BODY:{id:3,name:"Body"},BELLY:{id:4,name:"Belly"},LEGS:{id:5,name:"Legs"}},n={1:{name:"Knight",attCount:1,defCount:3},2:{name:"Warrior",attCount:1,defCount:2},3:{name:"Warrior 2",attCount:2,defCount:1},4:{name:"Warrior 3",attCount:2,defCount:2}},r=t=>new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=n,r.src=t,r.alt="avatar"});class a{constructor(t="",e=0,n=0,r="",a=!1,i=150,s=0,o=0){this.name=t,this.avatar=r,this.wins=e,this.loses=n,this.player=a,this.health=i,this.attCount=s,this.defCount=o}}class i extends a{constructor(t,e,n,r="./assets/avatars/avatar1.jpg",a,i,s,o){super(t,e,n,r,a,i,s,o),this.avatar=r,this.player=!0,this.attCount=1,this.defCount=2}}class s{constructor(t,e=0,n=0,r){this.name=t,this.wins=e,this.loses=n,this.avatar=r}}class o{constructor(t){return new i(t.name,t.wins,t.loses,t.avatar,!0,this.health=150,1,2)}}class c{constructor(t){return new s(t.name,t.wins,t.loses,t.avatar)}}const l="player";class u{constructor(t,e){this.repository=t,this.storageRepository=e}reduce(){throw new Error("reduce() must be implemented in subclass")}}class h extends u{constructor(t,e){super(t,e),this.player=null,this.state=this.createDefaultSettingState()}reduce(t){this.player.name=t.characterName,this.repository.savePlayer(this.player)}async loadPlayer(){const t=await this.repository.getPlayer();return this.player=t,t}toggleEdit(){return this.state={...this.state,isSave:!this.state.isSave},this.state}createDefaultSettingState(){return{name:"Edit",characterName:"",isLoading:!0,error:null}}restoreState(){const t=this.storageRepository.getItem("rootState",!0);t&&(this.state=t)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}var p=function(t,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},p(t,e)};function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function m(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){a={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return s}function b(t,e,n){if(n||2===arguments.length)for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function g(t){return"function"==typeof t}function w(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var C=w(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function S(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var x=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,a;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=m(i),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else i.remove(this);var c=this.initialTeardown;if(g(c))try{c()}catch(t){a=t instanceof C?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=m(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{L(p)}catch(t){a=null!=a?a:[],t instanceof C?a=b(b([],f(a)),f(t.errors)):a.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(a)throw new C(a)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)L(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&S(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&S(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t;var e}(),k=x.EMPTY;function E(t){return t instanceof x||t&&"closed"in t&&g(t.remove)&&g(t.add)&&g(t.unsubscribe)}function L(t){g(t)?t():t.unsubscribe()}var A=null,I=null,$=void 0,_=!1,P=!1,D={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var a=D.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,b([t,e],f(n))):setTimeout.apply(void 0,b([t,e],f(n)))},clearTimeout:function(t){var e=D.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function T(t){D.setTimeout(function(){if(!A)throw t;A(t)})}function N(){}var O=Z("C",void 0,void 0);function Z(t,e,n){return{kind:t,value:e,error:n}}var V=null;function B(t){if(_){var e=!V;if(e&&(V={errorThrown:!1,error:null}),t(),e){var n=V,r=n.errorThrown,a=n.error;if(V=null,r)throw a}}else t()}var R=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,E(e)&&e.add(n)):n.destination=z,n}return d(e,t),e.create=function(t,e,n){return new M(t,e,n)},e.prototype.next=function(t){this.isStopped?G(function(t){return Z("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?G(Z("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?G(O,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(x),F=Function.prototype.bind;function j(t,e){return F.call(t,e)}var q=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){H(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){H(t)}else H(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){H(t)}},t}(),M=function(t){function e(e,n,r){var a,i,s=t.call(this)||this;return g(e)||!e?a={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&P?((i=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},a={next:e.next&&j(e.next,i),error:e.error&&j(e.error,i),complete:e.complete&&j(e.complete,i)}):a=e,s.destination=new q(a),s}return d(e,t),e}(R);function H(t){var e;_?(e=t,_&&V&&(V.errorThrown=!0,V.error=e)):T(t)}function G(t,e){var n=I;n&&D.setTimeout(function(){return n(t,e)})}var z={closed:!0,next:N,error:function(t){throw t},complete:N},U="function"==typeof Symbol&&Symbol.observable||"@@observable";function K(t){return t}var Y=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,a=this,i=(r=t)&&r instanceof R||function(t){return t&&g(t.next)&&g(t.error)&&g(t.complete)}(r)&&E(r)?t:new M(t,e,n);return B(function(){var t=a,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?a._subscribe(i):a._trySubscribe(i))}),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Q(e))(function(e,r){var a=new M({next:function(e){try{t(e)}catch(t){r(t),a.unsubscribe()}},error:r,complete:e});n.subscribe(a)})},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[U]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0===(n=t).length?K:1===n.length?n[0]:function(t){return n.reduce(function(t,e){return e(t)},t)})(this);var n},t.prototype.toPromise=function(t){var e=this;return new(t=Q(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function Q(t){var e;return null!==(e=null!=t?t:$)&&void 0!==e?e:Promise}var W=w(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),J=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return d(e,t),e.prototype.lift=function(t){var e=new X(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new W},e.prototype.next=function(t){var e=this;B(function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var a=m(e.currentObservers),i=a.next();!i.done;i=a.next())i.value.next(t)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}})},e.prototype.error=function(t){var e=this;B(function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}})},e.prototype.complete=function(){var t=this;B(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,a=n.isStopped,i=n.observers;return r||a?k:(this.currentObservers=null,i.push(t),new x(function(){e.currentObservers=null,S(i,t)}))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,a=e.isStopped;n?t.error(r):a&&t.complete()},e.prototype.asObservable=function(){var t=new Y;return t.source=this,t},e.create=function(t,e){return new X(t,e)},e}(Y),X=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return d(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:k},e}(J);class tt{constructor(t,e){this.model=e,this.fragmentState=t,this.container=null,this.subscriptions=[],this.intent$=new J}async createView(){throw new Error("createView() must be implemented in subclass")}updateView(){throw new Error("updateView() must be implemented in subclass")}subscribe(t){const e=t.subscribe(t=>this.intent$.next(t));this.subscriptions.push(e)}intent(){throw new Error("intent() must be implemented in subclass")}}var et=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function nt(t){return g(null==t?void 0:t.then)}function rt(t){return g(t[U])}function at(t){return Symbol.asyncIterator&&g(null==t?void 0:t[Symbol.asyncIterator])}function it(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var st="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ot(t){return g(null==t?void 0:t[st])}function ct(t){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(t,e||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(t){return function(e){return Promise.resolve(e).then(t,l)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(t,e){a[t]&&(r[t]=function(e){return new Promise(function(n,r){i.push([t,e,n,r])>1||o(t,e)})},e&&(r[t]=e(r[t])))}function o(t,e){try{(n=a[t](e)).value instanceof v?Promise.resolve(n.value.v).then(c,l):u(i[0][2],n)}catch(t){u(i[0][3],t)}var n}function c(t){o("next",t)}function l(t){o("throw",t)}function u(t,e){t(e),i.shift(),i.length&&o(i[0][0],i[0][1])}}(this,arguments,function(){var e,n,r;return y(this,function(a){switch(a.label){case 0:e=t.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,v(e.read())];case 3:return n=a.sent(),r=n.value,n.done?[4,v(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,v(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function lt(t){return g(null==t?void 0:t.getReader)}function ut(t){if(t instanceof Y)return t;if(null!=t){if(rt(t))return a=t,new Y(function(t){var e=a[U]();if(g(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(et(t))return r=t,new Y(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()});if(nt(t))return n=t,new Y(function(t){n.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,T)});if(at(t))return ht(t);if(ot(t))return e=t,new Y(function(t){var n,r;try{for(var a=m(e),i=a.next();!i.done;i=a.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()});if(lt(t))return ht(ct(t))}var e,n,r,a;throw it(t)}function ht(t){return new Y(function(e){(function(t,e){var n,r,a,i,s,o,c,l;return s=this,o=void 0,l=function(){var s,o;return y(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=m(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,a){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,a,(e=t[n](e)).done,e.value)})}}}(t),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=c.sent(),a={error:o},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})},new((c=void 0)||(c=Promise))(function(t,e){function n(t){try{a(l.next(t))}catch(t){e(t)}}function r(t){try{a(l.throw(t))}catch(t){e(t)}}function a(e){var a;e.done?t(e.value):(a=e.value,a instanceof c?a:new c(function(t){t(a)})).then(n,r)}a((l=l.apply(s,o||[])).next())})})(t,e).catch(function(t){return e.error(t)})})}function pt(t){return function(e){if(function(t){return g(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(t){this.error(t)}});throw new TypeError("Unable to lift unknown Observable type")}}function dt(t,e,n,r,a){return new yt(t,e,n,r,a)}var yt=function(t){function e(e,n,r,a,i,s){var o=t.call(this,e)||this;return o.onFinalize=i,o.shouldUnsubscribe=s,o._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,o._error=a?function(t){try{a(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,o._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,o}return d(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(R);function mt(t,e){return pt(function(n,r){var a=0;n.subscribe(dt(r,function(n){r.next(t.call(e,n,a++))}))})}function ft(t,e,n,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);var i=e.schedule(function(){n(),a?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!a)return i}function bt(t,e,n){return void 0===n&&(n=1/0),g(e)?bt(function(n,r){return mt(function(t,a){return e(n,t,r,a)})(ut(t(n,r)))},n):("number"==typeof e&&(n=e),pt(function(e,r){return function(t,e,n,r){var a=[],i=0,s=0,o=!1,c=function(){!o||a.length||i||e.complete()},l=function(t){return i<r?u(t):a.push(t)},u=function(t){i++;var o=!1;ut(n(t,s++)).subscribe(dt(e,function(t){e.next(t)},function(){o=!0},void 0,function(){if(o)try{i--;for(var t=function(){var t=a.shift();u(t)};a.length&&i<r;)t();c()}catch(t){e.error(t)}}))};return t.subscribe(dt(e,l,function(){o=!0,c()})),function(){}}(e,r,t,n)}))}var vt=Array.isArray;var gt=["addListener","removeListener"],wt=["addEventListener","removeEventListener"],Ct=["on","off"];function St(t,e,n,r){if(g(n)&&(r=n,n=void 0),r)return St(t,e,n).pipe((a=r,mt(function(t){return function(t,e){return vt(e)?t.apply(void 0,b([],f(e))):t(e)}(a,t)})));var a,i=f(function(t){return g(t.addEventListener)&&g(t.removeEventListener)}(t)?wt.map(function(r){return function(a){return t[r](e,a,n)}}):function(t){return g(t.addListener)&&g(t.removeListener)}(t)?gt.map(xt(t,e)):function(t){return g(t.on)&&g(t.off)}(t)?Ct.map(xt(t,e)):[],2),s=i[0],o=i[1];if(!s&&et(t))return bt(function(t){return St(t,e,n)})(ut(t));if(!s)throw new TypeError("Invalid event target");return new Y(function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return s(e),function(){return o(e)}})}function xt(t,e){return function(n){return function(r){return t[n](e,r)}}}function kt(t){return void 0===t&&(t=1/0),bt(K,t)}var Et=new Y(function(t){return t.complete()});function Lt(t){return t&&g(t.schedule)}function At(t){return t[t.length-1]}function It(t){return Lt(At(t))?t.pop():void 0}function $t(t,e){return void 0===e&&(e=0),pt(function(n,r){n.subscribe(dt(r,function(n){return ft(r,t,function(){return r.next(n)},e)},function(){return ft(r,t,function(){return r.complete()},e)},function(n){return ft(r,t,function(){return r.error(n)},e)}))})}function _t(t,e){return void 0===e&&(e=0),pt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Pt(t,e){if(!t)throw new Error("Iterable cannot be null");return new Y(function(n){ft(n,e,function(){var r=t[Symbol.asyncIterator]();ft(n,e,function(){r.next().then(function(t){t.done?n.complete():n.next(t.value)})},0,!0)})})}function Dt(t,e){return e?function(t,e){if(null!=t){if(rt(t))return function(t,e){return ut(t).pipe(_t(e),$t(e))}(t,e);if(et(t))return function(t,e){return new Y(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}(t,e);if(nt(t))return function(t,e){return ut(t).pipe(_t(e),$t(e))}(t,e);if(at(t))return Pt(t,e);if(ot(t))return function(t,e){return new Y(function(n){var r;return ft(n,e,function(){r=t[st](),ft(n,e,function(){var t,e,a;try{e=(t=r.next()).value,a=t.done}catch(t){return void n.error(t)}a?n.complete():n.next(e)},0,!0)}),function(){return g(null==r?void 0:r.return)&&r.return()}})}(t,e);if(lt(t))return function(t,e){return Pt(ct(t),e)}(t,e)}throw it(t)}(t,e):ut(t)}function Tt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=It(t),r=function(t){return"number"==typeof At(t)?t.pop():1/0}(t),a=t;return a.length?1===a.length?ut(a[0]):kt(r)(Dt(a,n)):Et}class Nt{constructor(t="app"){this.namespace=t,this.changePlayer$=new J}getItem(t){const e=localStorage.getItem(`${this.namespace}:${t}`);if(!e)return null;const n=JSON.parse(e);return Promise.resolve(Object.assign(new s,n))}setItem(t,e){localStorage.setItem(`${this.namespace}:${t}`,JSON.stringify(e)),this.changePlayer$.next({key:t,value:e})}removeItem(t){localStorage.removeItem(`${this.namespace}:${t}`)}}function Ot(t,e){return pt(function(n,r){var a=0;n.subscribe(dt(r,function(n){return t.call(e,n,a++)&&r.next(n)}))})}class Zt{saveCharacter(t){}}class Vt extends u{reduce(t){const e=new i(t.characterName);this.repository.saveCharacter(e)}}var Bt=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return d(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){var t=this,e=t.hasError,n=t.thrownError,r=t._value;if(e)throw n;return this._throwIfClosed(),r},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(J);class Rt extends u{constructor(t,e){super(t,e),this.state=null,this.character=null,this.character$=new Bt,this.state$=new J,Dt(this.repository.getCharacter()).subscribe(t=>{this.character=t,this.character$.next(t),this.saveState()}),this.repository.characterChanges$.subscribe(t=>{this.character=t,this.character$.next(t),this.saveState()}),this.restoreState()}pushState(t){this.state$.next({changeClick:t.changeClick})}changeAvatar(t){this.character.avatar=t.url,this.repository.saveCharacter(this.character)}restoreState(){const t=this.storageRepository.getItem("characterState",!0);t&&(this.character=t)}saveState(){this.storageRepository.setItem("characterState",this.character,!0)}clearState(){this.storageRepository.removeItem("characterState",!0)}}class Ft{async getCharacter(){throw new Error("getCharacter() must be implemented in subclass")}saveCharacter(t){throw new Error("saveCharacter() must be implemented in subclass")}}class jt{getItem(t,e=!1){throw new Error("Not implemented")}setItem(t,e,n=!1){throw new Error("Not implemented")}removeItem(t,e=!1){throw new Error("Not implemented")}}var qt=function(t){function e(e,n){return t.call(this)||this}return d(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(x),Mt={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var a=Mt.delegate;return(null==a?void 0:a.setInterval)?a.setInterval.apply(a,b([t,e],f(n))):setInterval.apply(void 0,b([t,e],f(n)))},clearInterval:function(t){var e=Mt.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Ht=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return d(e,t),e.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(a,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),Mt.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&Mt.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n,r=!1;try{this.work(t)}catch(t){r=!0,n=t||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,S(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(qt),Gt={now:function(){return(Gt.delegate||Date).now()},delegate:void 0},zt=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=Gt.now,t}(),Ut=new(function(t){function e(e,n){void 0===n&&(n=zt.now);var r=t.call(this,e,n)||this;return r.actions=[],r._active=!1,r}return d(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(zt))(Ht),Kt=Ut;function Yt(t){return t<=0?function(){return Et}:pt(function(e,n){var r=0;e.subscribe(dt(n,function(e){++r<=t&&(n.next(e),t<=r&&n.complete())}))})}function Qt(t,e){return e?function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return kt(1)(Dt(t,It(t)))}(e.pipe(Yt(1),pt(function(t,e){t.subscribe(dt(e,N))})),n.pipe(Qt(t)))}:bt(function(e,n){return ut(t(e,n)).pipe(Yt(1),function(t){return mt(function(){return t})}(e))})}class Wt{constructor(t=[],e=[],n=[]){this.attackZoneList=t,this.defenceZoneList=e,this.superAttackZoneList=n}}class Jt{constructor(t=new i,e=new a,n=[],r=new Wt,s=new Wt,o=!1,c=!1){this.player=t,this.enemy=e,this.playerScore=this.player.health,this.enemyScore=this.enemy.health,this.playerAttackZoneCount=this.player.attCount,this.playerDefenceZoneCount=this.player.defCount,this.playerDisposition=r,this.enemyDisposition=s,this.battleLog=n,this.finish=o,this.isReady=c}}class Xt{constructor(t="",e=new Jt){this.type=t,this.battle=e}}class te extends u{constructor(t,e,n){var r,a;super(t,e),this.battleInteractor=n,this.battle=null,this.battleQueue$=new J,this.battle$=new Bt(null),this.battleQueue$.pipe((r=t=>Dt([t]).pipe(function(t,e){void 0===e&&(e=Ut);var n=function(t,e,n){void 0===t&&(t=0),void 0===n&&(n=Kt);var r=-1;return null!=e&&(Lt(e)?n=e:r=e),new Y(function(e){var a,i=(a=t)instanceof Date&&!isNaN(a)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){e.closed||(e.next(s++),0<=r?this.schedule(void 0,r):e.complete())},i)})}(t,e);return Qt(function(){return n})}(t.delay||0)),g(a)?bt(r,a,1):bt(r,1))).subscribe(t=>{this.battle$.next(t.state)}),this.restoreState(),this.getBattle(),this.repository.playerChanges$.subscribe(t=>{this.battle.player=t,this.battle$.next(new Xt("player",this.battle))})}async attackSession(){this.battle.enemyDisposition=this.battleInteractor.createEnemyDisposition(this.battle.enemy);const t=await this.battleInteractor.attackSession(this.battle.playerDisposition,this.battle.enemyDisposition);this.battle.playerScore-=t.player.damage,this.battle.enemyScore-=t.enemy.damage,(this.battle.playerScore<=0||this.battle.enemyScore<=0)&&(this.battle.finish=!0),t.player.log.forEach(t=>{this.battle.battleLog.push(t.replaceAll("**",this.battle.player.name).replaceAll("&&",this.battle.enemy.name))}),t.enemy.log.forEach(t=>{this.battle.battleLog.push(t.replaceAll("&&",this.battle.player.name).replaceAll("**",this.battle.enemy.name))}),this.saveState(),this.battle$.next(new Xt("attack",this.battle))}async loadPlayer(){const t=await this.repository.getPlayer();return this.battle.player=t,this.battle.player=this.battle.player,this.saveState(),t}createEnemy(){return this.battleInteractor.createEnemy()}createEnemyDisposition(){this.battle.enemyDisposition=this.battleInteractor.createEnemyDisposition(this.battle.enemy),this.saveState()}async updateTypePlayerAttack(){const t=await this.battleInteractor.updateTypeAttack(this.battle.playerDisposition);this.battle.playerDisposition=t,this.saveState()}updatePlayerDisposition(t){const e=this.battle.playerDisposition;"Attack"===t.group&&(t.checked&&!e.attackZoneList.includes(t.value.toUpperCase())?this.battle.playerDisposition.attackZoneList.push(t.value.toUpperCase()):(this.battle.playerDisposition.attackZoneList=e.attackZoneList.filter(e=>e!==t.value.toUpperCase()),this.battle.playerDisposition.superAttackZoneList=e.superAttackZoneList.filter(e=>e!==t.value.toUpperCase()))),"Defence"===t.group&&(t.checked?this.battle.playerDisposition.defenceZoneList.push(t.value.toUpperCase()):this.battle.playerDisposition.defenceZoneList=e.defenceZoneList.filter(e=>e!==t.value.toUpperCase())),this.saveState(),this.pushBattleChange()}pushBattleChange(){this.updateTypePlayerAttack();const t=this.battle.playerDisposition.attackZoneList.length,e=this.battle.playerDisposition.defenceZoneList.length,n=this.battle.playerDisposition.superAttackZoneList.length;this.battle.isReady=t+n===this.battle.playerAttackZoneCount&&e===this.battle.playerDefenceZoneCount,this.saveState(),this.battle$.next(new Xt("activeAttackButton",this.battle))}savePlayerResult(t){t.result>0?this.battle.player.wins+=Math.abs(t.result):this.battle.player.loses+=Math.abs(t.result),this.repository.saveBattleResalt(this.battle.player),this.repository.removeBattle(),this.resetBattle()}getBattle(){this.battle?Dt(this.repository.getPlayer()).subscribe(t=>{this.battle.player=t,this.saveState(),this.battleQueue$.next({state:new Xt("startFragment",this.battle),delay:15})}):Dt(this.repository.getBattle()).subscribe(t=>{t.battle?this.battle=t.battle:this.resetBattle(),this.battle.player=t.player,this.battleQueue$.next({state:new Xt("startFragment",this.battle),delay:15})})}async resetBattle(){this.battle=new Jt,this.battle.enemy=this.createEnemy(),this.battle.player=await this.repository.getPlayer(),this.clearState()}restoreState(){const t=this.storageRepository.getItem("battleState",!0);t&&(this.battle=t,this.battleQueue$.next({state:new Xt("restoreState",this.battle),delay:0}))}pushOnCreateView(){this.battleQueue$.next({state:new Xt("restoreState",this.battle),delay:0})}saveState(){this.storageRepository.setItem("battleState",this.battle,!0)}saveBattle(){this.repository.saveBattle(this.battle)}clearState(){this.storageRepository.removeItem("battleState",!0)}}class ee{async getPlayer(){throw new Error("getPlayer() must be implemented in subclass")}saveBattleResalt(){throw new Error("saveBattleResalt() must be implemented in subclass")}async saveBattle(t){throw new Error("saveBattleResalt() must be implemented in subclass")}}class ne{createEnemy(){let t=Math.floor(Math.random()*Object.values(n).length)+1;const e=Object.assign(new a,n[t]);return e.avatar=`./assets/avatars/avatar${t+4}.jpg`,e}createEnemyDisposition(t){let n,r=new Set;do{n=Math.floor(Math.random()*Object.values(e).length)+1,r.add(Object.keys(e).find(t=>e[t].id===n))}while(r.size<t.attCount);let a=new Set;do{n=Math.floor(Math.random()*Object.values(e).length)+1,a.add(Object.keys(e).find(t=>e[t].id===n))}while(a.size<t.defCount);const i=this.updateTypeAttack(new Wt([...r],[...a]));return console.log("disp",i),i}attackSession(t,n){const r=t,a=n,i=t=>`** attacked && to ${e[t].name} `,s=t=>`and deal ${t} damage.`,o=(t,n)=>i(t)+(n.defenceZoneList.includes(t)?(t=>`bat && was able to protected his ${e[t].name}`)(t):s(10));let c=r.attackZoneList.reduce((t,e)=>(t.log.push(o(e,a)),t.damage=a.defenceZoneList.includes(e)?t.damage:t.damage+10,t),{log:[],damage:0});r.superAttackZoneList.length>0&&(c=r.superAttackZoneList.reduce((t,e)=>(t.log.push(i(e).replace("attacked","criticaly attacked")+s(15)),t.damage=t.damage+15,t),c));let l=a.attackZoneList.reduce((t,e)=>(t.log.push(o(e,a)),t.damage=a.defenceZoneList.includes(e)?t.damage:t.damage+10,t),{log:[],damage:0});return a.superAttackZoneList.length>0&&(l=a.superAttackZoneList.reduce((t,e)=>(t.log.push(i(e).replace("attacked","criticaly attacked")+s(15)),t.damage=t.damage+15,t),l)),{player:c,enemy:l}}updateTypeAttack(t){let e=Math.floor(5*Math.random())+1,n=t;return n.attackZoneList.length>0&&1===e&&(n.superAttackZoneList.push(...n.attackZoneList.slice(-1)),n.attackZoneList.pop()),n}}class re{constructor(t=new HeroDto,e=0,n=0,r=[],a=new DispositionDto,i=new DispositionDto,s=!1){this.enemy=t,this.playerScore=e,this.enemyScore=n,this.playerDisposition=a,this.enemyDisposition=i,this.battleLog=r,this.isReady=s}}class ae{constructor(t=[],e=[],n=[]){this.attackZoneList=t,this.defenceZoneList=e,this.superAttackZoneList=n}}class ie{constructor(t="",e="",n=!1,r=0,a=0,i=0){this.name=t,this.avatar=e,this.player=n,this.health=r,this.attCount=a,this.defCount=i}}class se{constructor(t=new Jt){return new re(ce(t.enemy),t.playerScore,t.enemyScore,t.battleLog,oe(t.playerDisposition),oe(t.enemyDisposition),t.isReady)}}class oe{constructor(t=new Wt){return new ae(t.attackZoneList,t.defenceZoneList,t.superAttackZoneList)}}class ce{constructor(t=new a){return new ie(t.name,t.avatar,t.player,t.health,t.attCount,t.defCount)}}class le{constructor(t=new re){let e=new Jt;return e.enemy=ue(t.enemy),e.battleLog=t.battleLog,e.playerScore=t.playerScore,e.enemyScore=t.enemyScore,e.playerDisposition=he(t.playerDisposition),e.enemyDisposition=he(t.enemyDisposition),e.isReady=t.isReady,e}}class ue{constructor(t=new ie){let e=new Heho;return e.name=t.name,e.avatar=t.avatar,e.player=t.player,e.health=t.health,e.attCount=t.attCount,e.defCount=t.defCount,e}}class he{constructor(t=new ae){return new ae(t.attackZoneList,t.defenceZoneList,t.superAttackZoneList)}}class pe{async getPlayer(){throw new Error("Not implemented")}}const de=new class{constructor(){this.services=new Map}register(t,e){this.services.set(t,e)}resolve(t){return this.services.get(t)}};de.register(Nt,new Nt),de.register(ne,new ne),de.register(jt,new class extends jt{constructor(t="app"){super(),this.namespace=t}getItem(t,e=!1){const n=(e?sessionStorage:localStorage).getItem(`${this.namespace}:${t}`);return n?JSON.parse(n):null}setItem(t,e,n=!1){(n?sessionStorage:localStorage).setItem(`${this.namespace}:${t}`,JSON.stringify(e))}removeItem(t,e=!1){(e?sessionStorage:localStorage).removeItem(`${this.namespace}:${t}`)}}(de.resolve(Nt))),de.register(t,new class extends t{constructor(t){super(),this.apiClient=t}async getPlayer(){const t=await this.apiClient.getItem(l);return t?new o(t):null}savePlayer(t){this.apiClient.setItem(l,new c(t))}}(de.resolve(Nt),de.resolve(Nt))),de.register(Zt,new class extends Zt{constructor(t){super(),this.apiClaent=t}saveCharacter(t){this.apiClaent.setItem(l,new c(t))}}(de.resolve(Nt))),de.register(Ft,new class extends Ft{constructor(t){super(),this.apiClient=t,this.characterChanges$=this.apiClient.changePlayer$.pipe(Ot(t=>t.key===l),mt(t=>new o(t.value)))}async getCharacter(){const t=await this.apiClient.getItem(l);return t?new o(t):null}saveCharacter(t){this.apiClient.setItem(l,new c(t))}}(de.resolve(Nt))),de.register(ee,new class extends ee{constructor(t){super(),this.apiClient=t,this.playerChanges$=this.apiClient.changePlayer$.pipe(Ot(t=>t.key===l),mt(t=>new o(t.value)))}async getPlayer(){const t=await this.apiClient.getItem(l);return t?new o(t):null}saveBattleResalt(t){this.apiClient.setItem(l,new c(t))}async saveBattle(t){this.apiClient.setItem("localStorageBattle",new se(t))}async getBattle(){const t=await this.apiClient.getItem("localStorageBattle");return{battle:t?new le(t):null,player:await this.getPlayer()}}async removeBattle(){this.apiClient.removeItem("localStorageBattle")}}(de.resolve(Nt))),de.register(pe,new class extends pe{constructor(t){super(),this.apiClient=t}async getPlayer(){const t=await this.apiClient.getItem(l);return t?new o(t):null}}(de.resolve(Nt))),de.register(h,new h(de.resolve(t),de.resolve(jt))),de.register(Vt,new Vt(de.resolve(Zt))),de.register(Rt,new Rt(de.resolve(Ft),de.resolve(jt))),de.register("RootModel",new class extends u{constructor(t,e){super(t,e),this.state=this.createScreenState(),this.intent$=new J,this.bindRootIntent(document.querySelector("body"))}init(){""===location.hash||"#/"===location.hash?this.clearState():this.restoreState(),this.intent$.subscribe(t=>{t.type.startsWith("NAVIGATE")&&(this.updateScreen(t),this.saveState())});const t=location.hash.replace("#","");this.getPlayer(),t?this.intent$.next({type:"NAVIGATE",path:t}):this.intent$.next({type:"NAVIGATE",path:"/"})}async updateScreen(t){switch(t.path){case"/":try{this.state.isLoading=!0,await this.getPlayer()?this.intent$.next({type:"NAVIGATE",path:"/main"}):this.state={...this.state,screen:"Start",isLoading:!1,error:null}}catch(t){this.state={...this.state,isLoading:!1,error:t.message}}break;case"/main":this.state={...this.state,name:"Main",withHeader:!0,withFooter:!1,fragment:"mainFragment"};break;case"/battle":this.state={...this.state,name:"Battle",withHeader:!0,withFooter:!0,fragment:"battleFragment"};break;case"/setting":this.state={...this.state,name:"Setting",withHeader:!0,withFooter:!1,fragment:"settingFragment"},this.currentFragment&&this.currentFragment.unmount();break;case"/character":this.state={...this.state,name:"Character",withHeader:!0,withFooter:!1,fragment:"characterFragment"}}this.render(this.state),this.saveState()}createScreenState(){return{screen:"DEFAULT",name:"Welcome",withHeader:!1,withFooter:!1,isLoading:!0,error:null,fragment:null}}bindRootIntent(t){const e=[],n=t.querySelector(".main-button");n&&e.push(St(n,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/main"}))));const r=t.querySelector(".setting-button");r&&e.push(St(r,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/setting"}))));const a=t.querySelector(".character-button");a&&e.push(St(a,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/character"})))),e.length>0&&Tt(...e).subscribe(t=>this.intent$.next(t))}render(t){const e=document.querySelector("footer");e.classList.add("fade-in"),e.classList.toggle("show",this.state.withFooter);const n=document.querySelector("header");n.classList.add("fade-in"),n.classList.toggle("show",this.state.withHeader),n.querySelector(".screen-name").textContent=t.name}async getPlayer(){return await this.repository.getPlayer()}restoreState(){const t=this.storageRepository.getItem("rootState",!0);t&&(this.state=t)}saveState(){this.storageRepository.setItem("rootState",this.state,!0)}clearState(){this.storageRepository.removeItem("rootState",!0)}}(de.resolve(pe),de.resolve(jt))),de.register(te,new te(de.resolve(ee),de.resolve(jt),de.resolve(ne))),de.register("/setting",new class extends tt{constructor(t,e){super(t,e),this.fragmentState={isSave:!1},this.player=null,this.intent$.subscribe(t=>{"TEXT_CHANGE"===t.type&&(this.player.name=t.value),"SAVE"===t.type&&(this.model.reduce(t),this.fragmentState={...this.fragmentState,isSave:!this.fragmentState.isSave},this.updateView(),this.fragmentState.isSave&&this.model.reduce(t))})}async createView(){this.player||(this.player=await this.model.loadPlayer());let t=null,e=null,n=null,r=null;const a=document.createDocumentFragment(),i=document.createElement("div");i.classList.add("main-container"),i.classList.add("setting-container"),t=document.createElement("label"),t.textContent="Player Name:",n=document.createElement("span"),e=document.createElement("input"),e.type="text",e.name="character-name",n.classList.add("character-name"),r=document.createElement("button"),r.textContent=this.fragmentState.isSave?"Save":"Edit",e.value=this.player.name,n.textContent=this.player.name,e.classList.toggle("hidden",!this.fragmentState.isSave),n.classList.toggle("hidden",this.fragmentState.isSave),t.appendChild(n),t.appendChild(e),i.appendChild(t),i.appendChild(r);const s=St(e,"input").pipe(mt(t=>({type:"TEXT_CHANGE",value:t.target.value}))),o=St(r,"click").pipe(mt(()=>({type:"SAVE",characterName:this.player.name})));return this.subscribe(Tt(s,o)),a.appendChild(i),a}updateView(){let t=document.querySelector(".main-container button"),e=document.querySelector(".main-container input"),n=document.querySelector(".main-container .character-name");t.textContent=this.fragmentState.isSave?"Save":"Edit",e.value=`${this.player.name}`,n.textContent=this.player.name,e.classList.toggle("hidden",!this.fragmentState.isSave),n.classList.toggle("hidden",this.fragmentState.isSave)}}(null,de.resolve(h))),de.register("/main",new class extends tt{async createView(){const t=document.createDocumentFragment();let e=document.createElement("div");e.classList.add("main-container");let n=document.createElement("button");return n.classList.add("battle-button"),n.textContent="Fight!",e.appendChild(n),t.appendChild(e),this.subscribe(St(n,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/battle"})))),t}}),de.register("/character",new class extends tt{constructor(t,e){super(t,e),this.mainContainer=null,this.avatarContainer=null,this.intent$.subscribe(t=>{"CLICK"===t.type&&this.model.pushState(t),"AVATAR"===t.type&&this.model.changeAvatar(t)})}async createView(){const t=document.createDocumentFragment();this.mainContainer=document.createElement("div");let e=this.mainContainer;e.classList.add("main-container"),e.classList.add("character-container");const n=await r(this.model.character.avatar||""),a=St(n,"click").pipe(mt(()=>({type:"CLICK",changeClick:!0})));this.subscribe(a);let i=document.createElement("span");i.classList.add("character-name"),i.textContent=this.model.character.name||"";let s=document.createElement("span");s.classList.add("character-wins"),s.textContent=`wins: ${this.model.character.wins||0}'`;let o=document.createElement("span");return o.classList.add("character-loses"),o.textContent=`loses: ${this.model.character.loses||0}`,e.appendChild(n),e.appendChild(i),e.appendChild(s),e.appendChild(o),t.appendChild(e),t}updateView(t){let e=document.querySelector(".character-loses"),n=document.querySelector(".character-wins"),r=document.querySelector(".character-name");this.mainContainer.querySelector("img").src=t.avatar,r.textContent=t.name,n.textContent=`wins: ${t.wins}`,e.textContent=`loses: ${t.loses}`}async createAvatarsContainer(t){if(t.changeClick||this.avatarContainer.classList.remove("show"),t.changeClick&&!this.avatarContainer&&(this.avatarContainer=document.createElement("div"),this.avatarContainer.classList.add("avatars-container")),t.changeClick){let t=this.model.character.avatar.slice(-5,-4);this.avatarContainer.innerHTML="";const e=document.createElement("button");this.avatarContainer.appendChild(e),e.classList.add("close-button");const n=St(e,"click").pipe(mt(()=>({type:"CLICK",changeClick:!1})));this.subscribe(n);const a=document.createElement("div");for(let e=1;e<5;e+=1)if(e!==Number(t)){const t=await r(`./assets/avatars/avatar${e}.jpg`);a.appendChild(t);const n=St(t,"click").pipe(mt(()=>({type:"AVATAR",url:`./assets/avatars/avatar${e}.jpg`}))),i=St(t,"click").pipe(mt(()=>({type:"CLICK",changeClick:!0})));this.subscribe(Tt(n,i))}this.avatarContainer.appendChild(a),this.mainContainer.appendChild(this.avatarContainer),this.avatarContainer.classList.add("show")}else this.avatarContainer.remove("show")}mount(){this.subscriptions.push(this.model.character$.subscribe(t=>{this.updateView(t)})),this.subscriptions.push(this.model.state$.subscribe(t=>this.createAvatarsContainer(t)))}unmount(){this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[],this.container=null,this.model.clearState(),this.mainContainer=null,this.avatarContainer=null}}(null,de.resolve(Rt))),de.register("/battle",new class extends tt{constructor(t,e){super(t,e),this.logList=null,this.playerContainer=null,this.enemyContainer=null,this.attackCheckbox=null,this.defenceCheckbox=null,this.dispositionRules=null,this.playerName=null,this.enemyName=null,this.playerBaseScore=null,this.enemyBaseScore=null,this.intent$.subscribe(t=>{"GAME"===t.type&&this.model.attackSession(),"CHECK"===t.type&&this.model.updatePlayerDisposition(t),"SAVE"===t.type&&this.model.savePlayerResult(t)})}async createView(){document.querySelector("footer").classList.remove("show"),this.model.battle||this.model.getBattle();const t=document.createDocumentFragment();let n=null,r=null,a=null,i=null;i=document.createElement("div"),i.classList.add("main-container"),i.classList.add("battle"),this.playerContainer=document.createElement("div"),this.playerContainer.classList.add("player-container"),this.enemyContainer=document.createElement("div"),this.enemyContainer.classList.add("enemy-container"),this.playerContainer.appendChild(await this.createAttendeeView({player:!0})),this.enemyContainer.appendChild(await this.createAttendeeView({player:!1})),this.dispositionRules=document.createElement("span"),this.defenceCheckbox=document.createElement("div"),this.defenceCheckbox.classList.add("checkbox-container"),this.defenceCheckbox.classList.add("defence"),this.attackCheckbox=document.createElement("div"),this.attackCheckbox.classList.add("checkbox-container"),this.attackCheckbox.classList.add("attack"),this.defenceCheckbox.appendChild(this.createCheckbox(e,"Defence")),this.attackCheckbox.appendChild(this.createCheckbox(e,"Attack")),n=document.createElement("div"),n.classList.add("disposition-container"),r=document.createElement("form"),r.classList.add("checkbox-form"),a=document.createElement("button"),a.textContent="Attake!",a.disabled=!0;const s=St(a,"click").pipe(mt(()=>({type:"GAME"}))),o=St(r,"change").pipe(Ot(t=>"checkbox"===t.target.type),mt(t=>({type:"CHECK",group:t.target.name,value:t.target.value,checked:t.target.checked})));return this.subscribe(Tt(s,o)),n.appendChild(this.dispositionRules),r.appendChild(this.attackCheckbox),r.appendChild(this.defenceCheckbox),n.appendChild(r),n.appendChild(a),i.appendChild(this.playerContainer),i.appendChild(n),i.appendChild(this.enemyContainer),t.appendChild(i),document.querySelector("footer").classList.add("show"),t}onCreateView(t){this.dispositionRules.textContent=`Please pick ${t.playerAttackZoneCount} Attack zone and ${t.playerDefenceZoneCount} Defence zone`,this.playerBaseScore.textContent=t.player.health,this.enemyBaseScore.textContent=t.enemy.health;const e=this.enemyContainer.querySelector("h6"),n=this.enemyContainer.querySelector("img");n.src!==t.enemy.avatar&&(n.src=t.enemy.avatar),e.textContent=t.enemy.name,this.updateView(t)}async createAttendeeView(t){const e=document.createDocumentFragment();let n=null,a=null,i=null,s=null;return t.player?(this.playerName=document.createElement("h6"),this.playerBaseScore=document.createElement("span"),e.appendChild(this.playerName)):(this.enemyName=document.createElement("h6"),this.enemyBaseScore=document.createElement("span"),e.appendChild(this.enemyName)),n=await r("./assets/avatars/avatar1.jpg"),a=document.createElement("div"),a.classList.add("score-line"),i=document.createElement("div"),s=document.createElement("span"),s.classList.add("current-score"),s.textContent="",i.appendChild(s),i.append(" / "),i.appendChild(t.player?this.playerBaseScore:this.enemyBaseScore),e.appendChild(n),e.appendChild(a),e.appendChild(i),e}createCheckbox(t,e){const n=document.createDocumentFragment();let r=document.createElement("p");r.textContent=`${e} Zones`,n.appendChild(r);for(const r of Object.values(t)){const t=document.createElement("label"),a=document.createElement("input");a.type="checkbox",a.value=r.name,a.name=e;const i=document.createTextNode(r.name);"Attack"===e?(t.appendChild(a),t.insertBefore(i,a)):(t.appendChild(a),t.appendChild(i)),n.appendChild(t)}return n}updateView(t){this.updatePlayer(t.player),this.updateCheckbox(t),this.updateScore({player:!0},t),this.updateScore({player:!1},t),this.updateLogs(t.battleLog),this.updateButtonState(t),t.finish&&this.updateFinish(t)}updatePlayer(t){const e=this.playerContainer.querySelector("h6"),n=this.playerContainer.querySelector("img");n.src!==t.avatar&&(n.src=t.avatar),e.textContent=t.name}updateCheckbox(t){t.playerDisposition.attackZoneList.forEach(t=>{this.attackCheckbox.querySelector(`input[value = "${e[t].name}"]`).checked=!0}),t.playerDisposition.superAttackZoneList.forEach(t=>{this.attackCheckbox.querySelector(`input[value = "${e[t].name}"]`).checked=!0}),t.playerDisposition.defenceZoneList.forEach(t=>{this.defenceCheckbox.querySelector(`input[value = "${e[t].name}"]`).checked=!0})}updateScore(t,e){const n=document.querySelector("."+(t.player?"player-container":"enemy-container")),r=t.player?e.playerScore:e.enemyScore,a=Math.floor(r/(t.player?e.player.health:e.enemy.health)*100);n.querySelector(".score-line").style.background=`linear-gradient(to right, #710707 0%, #710707 ${a}%, #C4C4C4 ${a}%, #C4C4C4 100%)`,n.querySelector(".current-score").textContent=r}createScore(t,e,n){const r=t.player?this.model.battle.playerScore:this.model.battle.enemyScore,a=Math.floor(r/t.health*100);e.style.background=`linear-gradient(to right, #710707 0%, #710707 ${a}%, #C4C4C4 ${a}%, #C4C4C4 100%)`,n.textContent=r}updateButtonState(t){document.querySelector(".disposition-container button").disabled=!t.isReady||t.finish}updateLogs(t){this.logList=document.querySelector(".log-list");for(let e=this.logList.querySelectorAll("li").length;e<t.length;e+=1){let n=document.createElement("li");n.innerHTML=t[e].replace(this.model.battle.player.name,`<strong>${this.model.battle.player.name}</strong>`).replace(this.model.battle.enemy.name,`<strong>${this.model.battle.enemy.name}</strong>`),this.logList.appendChild(n)}}updateFinish(t){if(t.finish){const e=document.querySelector(".main-container");let n=document.createElement("div");n.classList.add("finish-message"),e.appendChild(n),n.classList.add("show"),t.playerScore>t.enemyScore?n.textContent="Congratulation with your win!":n.textContent="Maybe next time :(";const r=St(n,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/character"}))),a=St(n,"click").pipe(mt(()=>({type:"SAVE",result:t.playerScore>t.enemyScore?1:-1})));this.subscribe(Tt(a,r))}}mount(){this.model.battle&&this.model.pushOnCreateView(),this.subscriptions.push(this.model.battle$.pipe(Ot(t=>"attack"===t.type)).subscribe(t=>{this.updateScore({player:!0},t.battle),this.updateScore({player:!1},t.battle),this.updateLogs(t.battle.battleLog),this.updateButtonState(t.battle),t.battle.finish&&this.updateFinish(t.battle)})),this.subscriptions.push(this.model.battle$.pipe(Ot(t=>"restoreState"===t.type)).subscribe(t=>{this.onCreateView(t.battle)})),this.subscriptions.push(this.model.battle$.pipe(Ot(t=>"activeAttackButton"===t.type)).subscribe(t=>{this.updateButtonState(t.battle)})),this.subscriptions.push(this.model.battle$.pipe(Ot(t=>"player"===t.type)).subscribe(t=>this.updatePlayer(t.battle.player))),this.subscriptions.push(this.model.battle$.pipe(Ot(t=>"startFragment"===t.type)).subscribe(t=>this.onCreateView(t.battle)))}unmount(){this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[],this.logList&&0===this.model.battle.battleLog.length&&(this.logList.innerHTML=""),this.playerContainer=null,this.enemyContainer=null,this.attackCheckbox=null,this.defenceCheckbox=null}}(null,de.resolve(te))),de.register("/",new class extends tt{constructor(t,e){super(t,e),this.characterName="",this.intent$.subscribe(t=>{"TEXT_CHANGE"===t.type&&(this.characterName=t.value),"SAVE"===t.type&&this.model.reduce(t)})}async createView(){const t=document.createDocumentFragment(),e=document.createElement("div");e.classList.add("main-container"),e.classList.add("start-container");const n=document.createElement("h1");n.textContent="Create Your Character";const r=document.createElement("label");r.innerHTML="Character Name <br></br>";const a=document.createElement("input");a.type="text",a.value=this.characterName,r.appendChild(a);const i=St(a,"input").pipe(mt(t=>({type:"TEXT_CHANGE",value:t.target.value}))),s=document.createElement("button");s.textContent="Create character!",e.appendChild(n),e.appendChild(r),e.appendChild(s),t.appendChild(e);const o=St(s,"click").pipe(mt(()=>({type:"NAVIGATE",path:"/main"}))),c=St(s,"click").pipe(mt(()=>({type:"SAVE",characterName:this.characterName})));return this.subscribe(Tt(i,c,o)),t}}(null,de.resolve(Vt)));const ye=document.querySelector("main"),me=new class{constructor(t,e){this.container=t,this.di=e,this.currentFragment=null,this.fragments={},this.rootModel=this.di.resolve("RootModel"),window.addEventListener("hashchange",()=>{this.navigate(location.hash.replace("#","")||"/",!1)})}async navigate(t,e=!0){if(!this.fragments[t]){const e=this.di.resolve(t);this.fragments[t]=e,e.intent$&&e.intent$.subscribe(t=>this.rootModel.intent$.next(t))}this.currentFragment&&this.currentFragment.unmount&&this.currentFragment.unmount();const n=this.fragments[t];this.container.innerHTML="",this.currentFragment=n,n.createView().then(t=>{this.container.appendChild(t),n.mount&&n.mount()}).catch(t=>console.error(t)),e&&history.pushState({},"","#"+t)}init(){this.rootModel.intent$.subscribe(t=>{t.type.startsWith("NAVIGATE")&&this.navigate(t.path)}),this.rootModel.init()}}(ye,de);me.init()})();